{"version":3,"sources":["i18n.js","helpers/timeConverter.js","modules/StateListItem.js","modules/StateList.js","functions/blind.js","modules/AdapterStatus.js","modules/Chart.js","modules/DateTime.js","modules/Map.js","modules/StateListHorizontal.js","modules/Weather.js","modules/MultimediaItem.js","modules/Multimedia.js","i18n sync /^/.*/.js$","i18n/de.js","i18n/en.js","functions/door.js","functions/heating.js","functions/defaults.js","functions/location.js","functions/user.js","functions/window.js","components/GridContainer.js","components/StatusSnackbar.js","functions/index.js","Function.js","Adapters.js","Device.js","components/TopBar.js","helpers/useWindowDimensions.js","components/TabBar.js","modules/index.js","components/Popup.js","components/Widget.js","theme.js","Jarvis.js","App.js","serviceWorker.js","index.js","helpers/colorConverter.js","functions/light.js","Socket.js","Connection.js"],"names":["i18n","language","console","log","languages","Array","isArray","forEach","loadTranslation","translation","require","default","err","error","message","setTranslation","translations","lang","word","options","placeholders","toString","indexOf","parts","split","length","join","shift","key","replace","RegExp","ucFirst","charAt","toUpperCase","slice","navigator","userLanguage","timeToSeconds","time","hours","minutes","seconds","parseInt","timeToHoursMinutesSeconds","withHours","Number","isNaN","Math","floor","substr","secondsToDateTime","dateTimeFormat","format","Date","locale","de","styles","theme","defaultListDivider","margin","defaultListIcon","props","components","icon","horizontalListItem","display","textAlign","paddingRight","width","marginTop","horizontalListItemIcon","minWidth","horizontalListItemAction","top","right","position","transform","verticalListItemAction","ListItemIconElement","withStyles","customClassNames","children","classes","classNames","map","className","clsx","StateListItem","state","device","primaryStateKey","getDeviceState","secondaryStateKey","this","on","stateKey","setState","openDialog","horizontal","component","action","get","getIcon","val","primary","getAction","primaryAction","secondary","Fragment","divider","ListItem","finger","button","onClick","bind","ListItemIcon","getStyle","ListItemText","getComponent","getOption","subtitle","timeChanged","ListItemSecondaryAction","id","style","React","Component","defaultListSectionDivider","defaultListSectionDividerItem","padding","defaultListSectionText","breakpoints","down","horizontalList","flexDirection","flexWrap","ListDivider","getDevicesBySubgroup","subgroup","title","subgroupActions","handleChange","targetStatus","status","setDeviceState","ButtonGroup","color","size","Button","t","StateList","devices","push","settings","List","dense","i","listSection","listItem","useStyles","makeStyles","value","float","lineHeight","marginRight","noBorder","borderLeftColor","configurations","level","round","level2","unit","defaults","LevelComponent","actions","useState","setLevel","useEffect","activity","setActivity","states","requestDeviceState","catch","sKey","s","manufacturer","borderRightColor","disabled","AdapterStatus","adapterInformation","adapterAliveStatus","adapterUpdates","socket","Connection","getConnection","list","blacklist","updates","getState","subscribeState","getAdapterInstances","instances","rows","adapters","instance","common","name","concat","sort","item1","item2","getStates","subscribeStates","aliveStatus","prevState","updateList","JSON","parse","Object","keys","adapterList","loading","adapter","update","enabled","alive","connected","connection","tooltip","alt","src","extIcon","small","version","UpdateAvailable","availableVersion","runAsCompactMode","compactGroup","StatusIndicator","notAlive","container","UpdatesListItem","UpdatesIndicator","Settings","noDevicesAllowed","backgroundColor","spacing","paddingLeft","borderRadius","height","fontSize","Chart","chartFilter","chartConfig","yAxes","unshift","type","ticks","callback","yLeftAxisUnitBefore","parseFloat","toFixed","yLeftAxisUnitAfter","errors","datePicker","selectedTimeRangeValue","selectedTimeRangeUnit","selectedDateTime","dateNow","chartLabels","chartData","labels","datasets","chartPan","chartZoom","timer","timeRangeRef","createRef","chartRef","chartUpdates","chartOptions","maintainAspectRatio","spanGaps","legend","legendClickHandler","tooltips","callbacks","label","item","data","datasetIndex","scales","plugins","colorschemes","scheme","zoom","pan","mode","getTimeRange","axis","getAxis","requestDeviceStateHistory","history","start","end","step","addChartGraph","liveUpdates","updateChartGraph","prevProps","clearTimeout","setTimeout","getTime","timeRange","axisTimeFormat","helpers","prevMarker","markers","marker","index","entry","ts","reduce","a","b","chartIndex","findIndex","groupChartData","current","chartInstance","values","prevStates","dataSet","fill","graphConfig","e","legendItem","ci","meta","getDatasetMeta","hidden","resetZoom","inputRef","input","onChange","event","target","displayEmpty","disableUnderline","select","deLocale","utils","DateFnsUtils","open","onOpen","onClose","variant","ampm","InputProps","iconButton","dividerVertical","orientation","buttonDisabled","toolbar","errorMessage","severity","createElement","toolbarButtons","disableElevation","chartHeight","ref","alignItems","justifyContent","marginBottom","whiteSpace","marginLeft","flex","palette","main","DateTime","refTimer","useRef","setDateTime","city","setCity","sunrise","setSunrise","sunset","setSunset","refresh","getObject","latitude","longitude","getSunrise","getSunset","sun","mapOverview","left","bottom","zIndex","cursor","mapIconContainer","mapIconParent","boxShadow","mapIcon","content","mapTooltip","Map","defaultZoom","defaultPosition","setMarkers","memoizedMapInitialised","useCallback","memoizedHandleClick","flyTo","prevMarkers","mapMarkers","Marker","attributes","avatar","aria-label","arrow","useFlyTo","center","whenReady","attribution","url","markerIcon","offset","info","function","L","divIcon","html","iconSize","memoizedHandleMouseEvent","closeTooltip","openTooltip","riseOnHover","onMouseOver","direction","tooltipDirection","permanent","tooltipPermanent","StateListHorizontal","paper","Weather","setData","getRemoteResource","then","response","statusCode","body","weatherForecast","day","forecast","dailyForecast","date","justify","Multimedia","progress","progressTimeout","isRunning","duration","noHeader","styleImage","styleLengthBar","background","backgroundImage","backgroundUrlPrepend","playIconElements","Divider","image","noImage","information","informationLeft","grandParent","parent","informationRight","lengthBar","controls","controlsBox","controlsBoxLeft","controlsBoxCenter","Fab","controlButton","controlsBoxRight","backgroundPosition","minHeight","paddingTop","controlButtonSmall","MultimediaItem","webpackContext","req","webpackContextResolve","__webpack_require__","o","Error","code","resolve","module","exports","temperature","setTemperature","humidity","boost","Level","min","max","PowerAction","sliderMarkLabel","Action","secondaryAction","stateVal","parentOnChange","checked","setChecked","TriggerAction","startIcon","Label","linebreak","br","markSteps","markStep","markLabel","onChangeCommitted","defaultValue","valueLabelDisplay","marks","number","_any","battery","door","power","trigger","wind","gridContainer","GridContainer","contents","columns","grid","column","Grid","xs","sm","md","lg","xl","warn","success","green","dark","warning","amber","iconVariant","opacity","variantIcon","CheckCircleIcon","WarningIcon","ErrorIcon","InfoIcon","StatusSnackbar","autoHideDuration","closeButton","other","Icon","Snackbar","anchorOrigin","vertical","SnackbarContent","IconButton","blind","heating","jalousie","light","location","user","window","Function","functionType","functionId","toLowerCase","functions","defaultStyles","_isFunction","undefined","obj","EventEmitter","Device","deviceProperties","sysLang","room","_setProperties","stateSubscriptions","stateType","node","config","attribute","ignoredStates","ignoredState","hiddenStates","hideStates","hideState","stateOrAttribute","_getStateFromKey","Adapters","groups","group","formatDistanceToNow","lc","includeSeconds","addSuffix","pair","option","_getUserSetting","_getConfigurationSetting","property","forceDefault","stateProperty","deviceState","defaultIcon","subscribe","responses","Promise","reject","emit","_updateDeviceState","subscribeDeviceState","historyCache","getStateHistory","res","params","child","appBar","flexGrow","menuButton","transition","flexShrink","userSelect","TopBar","AppBar","Toolbar","Typography","getWindowDimensions","innerWidth","innerHeight","paddingBottom","tabs","borderBottom","fixed","indicator","fullscreen","TabBar","selectTab","tabBarProps","tab","setTab","setFixed","handleScroll","threshold","scrollY","prevFixed","document","getElementById","offsetTop","offsetHeight","addEventListener","removeEventListener","renderedTabs","Tab","Tabs","selectedTab","root","TabPanel","renderedTab","windowDimensions","setWindowDimensions","handleResize","useWindowDimensions","mapHeight","setMapHeight","topBarHeight","setHidden","Box","role","ModuleSettings","DialogTitle","grey","disableTypography","DialogContent","MuiDialogContent","DialogActions","MuiDialogActions","Popup","forceUpdate","allSettled","nextProps","nextState","closeDialog","Dialog","maxWidth","fullWidth","dividers","autoFocus","card","cardHeaderNoContents","cardAvatar","cardContent","Widget","iconStyle","Card","CardHeader","Avatar","CardContent","blue","pink","createMuiTheme","getGroup","groupId","Tag","Modules","getGridContents","gridContents","columnContents","Jarvis","tabTitle","notificationDrawer","dialog","dialogContents","layout","tabsEnabled","widgetProps","tabPanels","tabLabel","tabPanel","now","ThemeProvider","topBarTitle","getTabPanels","App","loaded","noErrorFunction","port","protocol","hostname","listeners","connect","useSettings","processDevices","debug","email","LogRocket","init","uuid","identify","setLanguage","loadTranslations","pageTitle","pageFavicon","href","promises","results","result","deviceList","groupedDevices","deviceId","jarvis","processDevice","groupDevice","CircularProgress","topBar","tabBar","gridColumns","SkeletonLoader","Skeleton","animation","gridItem","loaders","random","loader","renderError","renderLoadingProgress","renderLoadingSkeleton","Boolean","match","ReactDOM","render","serviceWorker","ready","registration","unregister","HsvToRgb","h","r","g","f","p","q","v","RgbToHex","LightColorAction","colorSpace","setColorSpace","colors","Red","Green","Blue","Hue","Saturation","Brightness","LightColorComponent","initialColor","onChangeComplete","colorTemperature","hue","rgb","hsv","hex","setHue","hsl","Socket","io","timeout","query","statesSubscribes","attempts","reason","stateChange","ids","cb","cbs","reg","task","hasOwnProperty","test","getObjectView","design","search","pattern","setUrl","setListeners","listener","setListener"],"mappings":"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","file":"static/js/main.5abe3535.chunk.js","sourcesContent":["/**\r\n * Internationalization\r\n * Based on https://raw.githubusercontent.com/ioBroker/adapter-react/master/src/i18n.js.\r\n * Copyright 2018-2019 bluefox <dogafox@gmail.com>\r\n *\r\n * MIT License\r\n *\r\n *\r\n */\r\nexport default class i18n {\r\n\r\n\t/*\r\n\t * holds the translations\r\n\t */\r\n\tstatic translations = {};\r\n\r\n\t/*\r\n\t * default language\r\n\t */\r\n\tstatic language = navigator.language || navigator.userLanguage || 'en';\r\n\r\n\t/**\r\n\t * Override default language.\r\n\t *\r\n\t * @param\t{String}\tlanguage\r\n\t * @return\t{Boolean}\r\n\t */\r\n\tstatic setLanguage(language) {\r\n\t\tif (language) {\r\n\t\t\ti18n.language = language;\r\n\t\t\tconsole.log('i18n: Set language to ' + language + '.');\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Loads multiple translations.\r\n\t *\r\n\t * @param\t{String|Array}\tlanguages\r\n\t * @return\t{Boolean}\r\n\t */\r\n\tstatic loadTranslations(languages) {\r\n\t\t\r\n\t\tif (languages) {\r\n\t\t\tlanguages = Array.isArray(languages) ? languages : [languages];\r\n\t\t\tlanguages.forEach(language => i18n.loadTranslation(language));\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Loads a translation.\r\n\t *\r\n\t * @param\t{String}\tlanguage\r\n\t * @return\t{Boolean}\r\n\t */\r\n\tstatic loadTranslation(language) {\r\n\t\t\r\n\t\tif (language) {\r\n\t\t\tlet translation;\r\n\t\t\ttry {\r\n\t\t\t\ttranslation = require('./i18n/' + language + '.js').default;\r\n\t\t\t}\r\n\t\t\tcatch(err) {\r\n\t\t\t\tconsole.error(err.message);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ti18n.setTranslation(language, translation);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn false;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Set a translation for language.\r\n\t *\r\n\t * @param\t{String}\tlanguage\r\n\t * @param\t{Object}\ttranslation\r\n\t * @return\t{Boolean}\r\n\t */\r\n\tstatic setTranslation(language, translation) {\r\n\t\tif (language && translation) {\r\n\t\t\ti18n.translations[language] = { ...i18n.translations[language] || {}, ...translation };\r\n\t\t\tconsole.log('i18n: Set translations for language ' + language + '.');\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get current set language.\r\n\t *\r\n\t * @param\tvoid\r\n\t * @return\t{String}\r\n\t */\r\n\tstatic getLanguage() {\r\n\t\treturn i18n.lang;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get current set language.\r\n\t *\r\n\t * @param\t{String}\tword\r\n\t * @param\t{Object}\t[options={}]\r\n\t * @param\t{Boolean}\t[options.ucFirst=false]\r\n\t * @param\t{Object}\t[placeholders={}]\r\n\t * @param\t{String}\t[language=i18n.language]\r\n\t * @return\t{String}\r\n\t */\r\n\tstatic t(word, options = {}, placeholders = {}, language = i18n.language) {\r\n\t\t\r\n\t\tword = word.toString();\r\n\t\tif (i18n.translations[language]) {\r\n\t\t\t\r\n\t\t\t// check if word is concatenated\r\n\t\t\tif (word.indexOf('#') > -1) {\r\n\t\t\t\t\r\n\t\t\t\tlet parts = word.split('#');\r\n\t\t\t\twhile (parts.length > 0 && !i18n.translations[language][parts.join('#')]) {\r\n\t\t\t\t\tparts.shift();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tword = i18n.translations[language][parts.join('#')] || word;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tword = i18n.translations[language][word] || word;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// replace placeholders\r\n\t\tfor (let key in placeholders) {\r\n\t\t\tword = word.replace(RegExp('%' + key + '%', 'g'), placeholders[key]);\r\n\t\t}\r\n\t\t\r\n\t\t// options\r\n\t\tif (options.ucFirst) {\r\n\t\t\tword = word.charAt(0).toUpperCase() + word.slice(1);\r\n\t\t}\r\n\t\t\r\n\t\treturn word;\r\n\t}\r\n}\r\n","import { format } from 'date-fns'\r\nimport { de } from 'date-fns/locale'\r\n\r\n/**\r\n *\r\n *\r\n */\r\nfunction timeToSeconds(time) {\r\n\t\r\n\tif (time.toString().indexOf(':') > -1) {\r\n\t\ttime = time.toString();\r\n\t\tlet format = time.split(':').length-1;\r\n\t\tlet [ hours, minutes, seconds ] = format > 1 ? time.split(':') : ('0:' + time).split(':');\r\n\t\ttime = parseInt(hours) * 3600 + parseInt(minutes) * 60 + parseInt(seconds);\r\n\t}\r\n\t\r\n\treturn parseInt(time);\r\n}\r\n\r\n/**\r\n *\r\n *\r\n */\r\nfunction timeToHoursMinutesSeconds(time, withHours = false) {\r\n\t\r\n\tif (time.toString().indexOf(':') > -1) {\r\n\t\treturn time;\r\n\t}\r\n\t\r\n\ttime = parseInt(time);\r\n\twithHours = withHours || (time > 3600);\r\n\t\r\n\tif (Number.isNaN(time)) {\r\n\t\treturn withHours ? '00:00:00' : '00:00';\r\n\t}\r\n\t\r\n\tlet hours = '0' + Math.floor(time/3600);\r\n\tlet minutes = '0' + Math.floor(time/60);\r\n\tlet seconds = '0' + (time % 60);\r\n\t\r\n\treturn withHours ? [ hours.substr(-2), minutes.substr(-2), seconds.substr(-2) ].join(':') : [ minutes.substr(-2), seconds.substr(-2) ].join(':');\r\n}\r\n\r\n/**\r\n *\r\n *\r\n */\r\nfunction secondsToDateTime(seconds, dateTimeFormat = 'dd. MMM yyyy, HH:mm') {\r\n\treturn format(new Date(seconds*1000), dateTimeFormat, { locale: de });\r\n}\r\n\r\n\r\nexport default {\r\n\ttimeToSeconds,\r\n\ttimeToHoursMinutesSeconds,\r\n\tsecondsToDateTime\r\n}","import React from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport ListItem from '@material-ui/core/ListItem'\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\r\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction'\r\nimport ListItemText from '@material-ui/core/ListItemText'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { withStyles } from '@material-ui/core/styles';\r\nconst styles = theme => ({\r\n\tdefaultListDivider: {\r\n\t\tmargin: '0 0 5px 0'\r\n\t},\r\n\tdefaultListIcon: props => ({\r\n\t\t...theme.components.icon,\r\n\t\t...props.styles\r\n\t}),\r\n\thorizontalListItem: {\r\n\t\tdisplay: 'inline-block',\r\n\t\ttextAlign: 'center',\r\n\t\tpaddingRight: '16px',\r\n\t\twidth: '140px',\r\n\t\tmarginTop: '10px'\r\n\t},\r\n\thorizontalListItemIcon: {\r\n\t\tminWidth: 'auto'\r\n\t},\r\n\thorizontalListItemAction: {\r\n\t\ttextAlign: 'center',\r\n\t\ttop: 0,\r\n\t\tright: 0,\r\n\t\tposition: 'static',\r\n\t\ttransform: 'none',\r\n\t},\r\n\tverticalListItemAction: {\r\n\t\ttextAlign: 'right'\r\n\t},\r\n});\r\n\r\n\r\nconst ListItemIconElement = withStyles(styles)(props => {\r\n\tconst { customClassNames, children, classes } = props;\r\n\t\r\n\tlet classNames = Array.isArray(customClassNames) ? customClassNames : [customClassNames];\r\n\tclassNames = classNames.map(className => (classes[className] ? classes[className] : className));\r\n\t\r\n\treturn <span className={clsx(classNames)}>{children}</span>\r\n});\r\n\r\n\r\nclass StateListItem extends React.Component {\r\n\t\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t\r\n\t\tthis.state = {}\r\n\t\tthis.state[this.props.device.primaryStateKey] = this.props.device.getDeviceState() || {}\r\n\t\t\r\n\t\tif (this.props.device.secondaryStateKey) {\r\n\t\t\tthis.state[this.props.device.secondaryStateKey] = this.props.device.getDeviceState(this.props.device.secondaryStateKey) || {}\r\n\t\t}\r\n\t}\r\n\t\r\n\tcomponentDidMount() {\r\n\t\t\r\n\t\tthis.props.device.on('stateChange', (stateKey, state) => {\r\n\t\t\tif (stateKey === this.props.device.primaryStateKey || stateKey === this.props.device.secondaryStateKey) {\r\n\t\t\t\tthis.setState({ [stateKey]: state });\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\topenDialog() {\r\n\t\tthis.props.openDialog(this.props.device);\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tconst { classes, horizontal, device, component, action } = this.props;\r\n\t\t\r\n\t\tconst state = this.state[device.primaryStateKey];\r\n\t\tconst options = device.get('options');\r\n\t\t\r\n\t\tlet icon = device.getIcon(device.primaryStateKey, state.val);\r\n\t\tlet primary = device.getAction(device.primaryStateKey, device.options.primaryAction === false);\r\n\t\tlet secondary = action && this.state[device.secondaryStateKey] ? device.getAction(device.secondaryStateKey) : null;\r\n\t\t\r\n\t\treturn (\r\n\r\n<React.Fragment>\r\n\t\r\n\t{options.divider && options.divider !== 'after' && <ListItem divider className={classes.defaultListDivider} />}\r\n\t\r\n\t<ListItem\r\n\t\tclassName={clsx(this.props.openDialog && classes.finger, horizontal && classes.horizontalListItem)}\r\n\t\tbutton={this.props.openDialog !== null}\r\n\t\tonClick={this.props.openDialog && this.openDialog.bind(this)}\r\n\t\t>\r\n\t\t\r\n\t\t<ListItemIcon className={clsx(horizontal && classes.horizontalListItemIcon)}>\r\n\t\t{icon === null ? <React.Fragment /> :\r\n\t\t\t<ListItemIconElement customClassNames={['defaultListIcon','mdi mdi-' + icon]} styles={device.getStyle('icon', device.primaryStateKey, state.val)} />\r\n\t\t}\r\n\t\t</ListItemIcon>\r\n\t\t\r\n\t\t<ListItemText\r\n\t\t\tprimary={(component && device.getComponent()) || device.getOption('label')}\r\n\t\t\tsecondary={(options.subtitle !== null ? (options.subtitle || (state && state.timeChanged) || null) : null)}\r\n\t\t\t/>\r\n\t\t\r\n\t\t<ListItemSecondaryAction className={ horizontal ? classes.horizontalListItemAction : classes.verticalListItemAction }>\r\n\t\t\t{!secondary ? primary : [ primary, <br key={'br_' + device.id} />, secondary ]}\r\n\t\t</ListItemSecondaryAction>\r\n\t</ListItem>\r\n\t\r\n\t{options.divider && options.divider === 'after' && <ListItem divider style={{margin: '5px 0'}} />}\r\n\t\r\n</React.Fragment>\r\n\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default withStyles(styles)(StateListItem);\r\n","import React from 'react'\r\nimport i18n from '../i18n'\r\n\r\nimport List from '@material-ui/core/List'\r\nimport ListItem from '@material-ui/core/ListItem'\r\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction'\r\nimport ListItemText from '@material-ui/core/ListItemText'\r\nimport StateListItem from './StateListItem'\r\nimport Button from '@material-ui/core/Button'\r\nimport ButtonGroup from '@material-ui/core/ButtonGroup'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { withStyles } from '@material-ui/core/styles';\r\nconst styles = theme => ({\r\n\tdefaultListSectionDivider: {\r\n\t\tmargin: '5px 0 0 0'\r\n\t},\r\n\tdefaultListSectionDividerItem: {\r\n\t\tmargin: '6px 0 7px 0',\r\n\t\tpadding: '0 16px !important'\r\n\t},\r\n\tdefaultListSectionText: {\r\n\t\tmargin: 0,\r\n\t\t[theme.breakpoints.down('md')]: {\r\n\t\t\tmargin: '0 0 0 10px',\r\n\t\t}\r\n\t},\r\n\thorizontalList: {\r\n\t\tdisplay: 'flex',\r\n\t\tflexDirection: 'row',\r\n\t\tflexWrap: 'wrap'\r\n\t}\r\n});\r\n\r\n\r\nconst ListDivider = withStyles(styles)(props => {\r\n\tconst { classes, getDevicesBySubgroup, subgroup, title, subgroupActions } = props;\r\n\t\r\n\tconst handleChangeOn = () => handleChange(true);\r\n\tconst handleChangeOff = () => handleChange(false);\r\n\tconst handleChange = targetStatus => {\r\n\t\t\r\n\t\tconst devices = getDevicesBySubgroup(subgroup);\r\n\t\tdevices.forEach(device => {\r\n\t\t\t\r\n\t\t\tlet status = targetStatus;\r\n\t\t\tif (device.primaryStateKey === 'level') {\r\n\t\t\t\tstatus = status ? 100 : 0;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdevice.setDeviceState(null, status);\r\n\t\t});\r\n\t}\r\n\t\r\n\treturn (\r\n\t\r\n<React.Fragment>\r\n\t<ListItem divider className={classes.defaultListSectionDivider} />\r\n\t<ListItem className={classes.defaultListSectionDividerItem}>\r\n\t\t<ListItemText\r\n\t\t\tclassName={classes.defaultListSectionText}\r\n\t\t\tprimary={title}\r\n\t\t\t/>\r\n\t\t\r\n\t\t<ListItemSecondaryAction>\r\n\t\t{subgroupActions === null || subgroupActions === false ? null :\r\n\t\t\t<ButtonGroup color=\"primary\" size=\"small\">\r\n\t\t\t\t<Button onClick={handleChangeOn}>{i18n.t('on')}</Button>\r\n\t\t\t\t<Button onClick={handleChangeOff}>{i18n.t('off')}</Button>\r\n\t\t\t</ButtonGroup>\r\n\t\t}\r\n\t\t\r\n\t\t</ListItemSecondaryAction>\r\n\t</ListItem>\r\n</React.Fragment>\r\n\t\r\n\t);\r\n});\r\n\r\nclass StateList extends React.Component {\r\n\t\r\n\tgetDevicesBySubgroup(subgroup) {\r\n\t\t\r\n\t\tlet devices = [];\r\n\t\tthis.props.devices.forEach(device => {\r\n\t\t\t\r\n\t\t\tif (subgroup === device.getOption('subgroup')) {\r\n\t\t\t\tdevices.push(device);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn devices;\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tconst { classes, horizontal, devices, settings, component, action, ...props } = this.props;\r\n\t\tlet subgroup;\r\n\t\t\r\n\t\treturn (\r\n\r\n<List dense={true} className={horizontal && classes.horizontalList}>\r\n\t{devices.map((device, i) => {\r\n\t\t\r\n\t\tconst listSection = subgroup !== null && device.options.subgroup !== null && device.options.subgroup !== subgroup && <ListDivider\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={'ListDivider-' + device.get('id')}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetDevicesBySubgroup={this.getDevicesBySubgroup.bind(this)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsubgroup={device.getOption('subgroup')}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle={device.options.subgroup}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsubgroupActions={settings.subgroupActions || device.options.subgroupActions}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\r\n\t\tconst listItem = <StateListItem\r\n\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\tkey={'StateListItem-' + device.get('id')}\r\n\t\t\t\t\t\t\thorizontal={horizontal}\r\n\t\t\t\t\t\t\tdevice={device}\r\n\t\t\t\t\t\t\tcomponent={component || false}\r\n\t\t\t\t\t\t\taction={action || true}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\r\n\t\tsubgroup = device.getOption('subgroup');\r\n\t\treturn [ listSection, listItem ];\r\n\t})}\r\n</List>\r\n\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default withStyles(styles)(StateList);\r\n","import React, { useState, useEffect } from 'react'\r\n\r\nimport Button from '@material-ui/core/Button'\r\nimport ButtonGroup from '@material-ui/core/ButtonGroup'\r\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess'\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\r\nimport StopIcon from '@material-ui/icons/Stop';\r\n\r\nimport defaults from './defaults'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\tvalue: props => ({\r\n\t\tfloat: 'left',\r\n\t\tlineHeight: '32px',\r\n\t\tmarginRight: '10px'\r\n\t}),\r\n\tnoBorder: {\r\n\t\tborderLeftColor: 'transparent'\r\n\t}\r\n}));\r\n\r\n\r\n/*\r\n * ACTIONS\r\n *\r\n */\r\nfunction BlindLevelAction(props) {\r\n\tconst { device, state, stateKey } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\tconst onGoUp = () => {\r\n\t\tsetLevel(100);\r\n\t\tsetActivity(true);\r\n\t\tdevice.setDeviceState(stateKey, 100).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\tconst onGoDown = () => {\r\n\t\tsetLevel(0);\r\n\t\tsetActivity(true);\r\n\t\tdevice.setDeviceState(stateKey, 0).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\tconst onStop = () => {\r\n\t\tsetActivity(false);\r\n\t\tdevice.setDeviceState('activity', true).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\t// level\r\n\tconst [level, setLevel] = useState(state.value);\r\n\tuseEffect(() => setLevel(state.value), [state.value]);\r\n\t\r\n\t// activity\r\n\tconst [activity, setActivity] = useState(null);\r\n\tuseEffect(() => {\r\n\t\t\r\n\t\tif (device.states.activity && device.states.activity.state) {\r\n\t\t\tdevice.states.activity.state = typeof device.states.activity.state === 'string' ? { 'node': device.states.activity.state } : device.states.activity.state;\r\n\t\t\t\r\n\t\t\t// request device state\r\n\t\t\tdevice.requestDeviceState('activity', true).catch(err => console.error(err));\r\n\t\t\t\r\n\t\t\t// listen for updates\r\n\t\t\tdevice.on('stateChange', (sKey, s) => {\r\n\t\t\t\tif (sKey === 'activity') {\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet val = s.val;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// HomeMatic\r\n\t\t\t\t\tif (device.options.manufacturer === 'HomeMatic') {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tswitch(val) {\r\n\t\t\t\t\t\t\tcase 1: // UP\r\n\t\t\t\t\t\t\tcase 2: // DOWN\r\n\t\t\t\t\t\t\t\tval = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tcase 3: // STABLE\r\n\t\t\t\t\t\t\tdefault: // UNKNOWN\r\n\t\t\t\t\t\t\t\tval = false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//\r\n\t\t\t\t\tsetActivity(val);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t}, [device]);\r\n\t\r\n\treturn (\r\n\r\n<React.Fragment>\r\n\t\r\n\t<div className={classes.value}>\r\n\t\t{level + state.unit}\r\n\t</div>\r\n\t\r\n\t<ButtonGroup size=\"small\">\r\n\t\t<Button color=\"primary\" onClick={onGoUp}><ExpandLessIcon /></Button>\r\n\t\t\t{activity !== null && <Button color=\"secondary\" style={{ borderRightColor: !activity ? 'transparent' : 'rgba(245, 0, 87, 0.5)' }} onClick={onStop} disabled={!activity}><StopIcon /></Button>}\r\n\t\t<Button color=\"primary\" style={activity !== null ? { borderLeftColor: !activity ? 'rgba(0, 0, 0, 0.26)' : 'transparent' } : {}} onClick={onGoDown}><ExpandMoreIcon /></Button>\r\n\t</ButtonGroup>\r\n</React.Fragment>\r\n\r\n\t);\r\n}\r\n\r\n\r\nexport default {\r\n\tconfigurations: {\r\n\t\tlevel: {\r\n\t\t\tvalue: val => Math.round(val),\r\n\t\t\ticon: {\r\n\t\t\t\t'default': 'window-shutter-open',\r\n\t\t\t\t'>90': 'window-shutter-open',\r\n\t\t\t\t'<=90': 'window-shutter'\r\n\t\t\t}\r\n\t\t},\r\n\t\tlevel2: {\r\n\t\t\tvalue: val => Math.round(val),\r\n\t\t\tunit: ' %',\r\n\t\t\ticon: {\r\n\t\t\t\t'default': 'window-shutter-open',\r\n\t\t\t\t'>90': 'window-shutter-open',\r\n\t\t\t\t'<=90': 'window-shutter'\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t\tlevel2: defaults.components.LevelComponent\r\n\t},\r\n\tactions: {\r\n\t\tlevel: BlindLevelAction\r\n\t},\r\n\tstyles: {\r\n\t}\r\n}","import React from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport Connection from '../Connection'\r\nimport i18n from '../i18n'\r\n\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Avatar from '@material-ui/core/Avatar'\r\nimport List from '@material-ui/core/List'\r\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar'\r\nimport ListItem from '@material-ui/core/ListItem'\r\nimport ListItemText from '@material-ui/core/ListItemText'\r\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction'\r\nimport StarIcon from '@material-ui/icons/Star';\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { withStyles } from '@material-ui/core/styles';\r\nconst styles = theme => ({\r\n\tUpdateAvailable: {\r\n\t\tcolor: '#CCAA00',\r\n\t},\r\n\tUpdatesListItem: {\r\n\t\tbackgroundColor: '#ffd700',\r\n\t\tcolor: '#fff',\r\n\t\tmargin: theme.spacing(0, -2),\r\n\t\tpaddingLeft: theme.spacing(2)\r\n\t},\r\n\tUpdatesIndicator: {\r\n\t\tright: theme.spacing(3.75),\r\n\t\tbackgroundColor: '#CCAA00',\r\n\t\tborderRadius: '50%',\r\n\t\twidth: theme.spacing(3),\r\n\t\theight: theme.spacing(3),\r\n\t\tcolor: '#fff',\r\n\t\ttextAlign: 'center',\r\n\t\tfontSize: '1rem !important'\r\n\t},\r\n\tStatusIndicator: {\r\n\t\tfontSize: '1.4rem'\r\n\t},\r\n\tloading: {\r\n\t\ttextAlign: 'center',\r\n\t\tmarginTop: '5px'\r\n\t},\r\n\tsmall: {\r\n\t\twidth: theme.spacing(3),\r\n\t\theight: theme.spacing(3),\r\n\t},\r\n\talive: {\r\n\t\tcolor: '#86d686'\r\n\t},\r\n\tnotAlive: {\r\n\t\tcolor: '#f7e43b'\r\n\t},\r\n\tdisabled: {\r\n\t\tcolor: '#bababa'\r\n\t}\r\n});\r\n\r\n\r\nclass AdapterStatus extends React.Component {\r\n\t\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t\r\n\t\tthis.state = {\r\n\t\t\tadapterInformation: [],\r\n\t\t\tadapterAliveStatus: {},\r\n\t\t\tadapterUpdates: {}\r\n\t\t}\r\n\t\t\r\n\t\tthis.socket = Connection.getConnection;\r\n\t\tthis.list = this.props.settings.list ? (Array.isArray(this.props.settings.list) ? this.props.settings.list : this.props.settings.list.split(',')) : null;\r\n\t\tthis.blacklist = this.props.settings.blacklist ? (Array.isArray(this.props.settings.blacklist) ? this.props.settings.blacklist : this.props.settings.blacklist.split(',')) : null;\r\n\t}\r\n\t\r\n\tcomponentDidMount() {\r\n\t\t\r\n\t\t// retrieve updates\r\n\t\tif (this.props.settings.updates !== false) {\r\n\t\t\tthis.socket.getState('admin.0.info.updatesJson', (id, adapterUpdates) => {\r\n\t\t\t\tthis.setState({ adapterUpdates });\r\n\t\t\t\t\r\n\t\t\t\t// get state updates\r\n\t\t\t\tthis.socket.subscribeState('admin.0.info.updatesJson', (err, adapterUpdates) => this.setState({ adapterUpdates }));\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\t// get adapter instances\r\n\t\tthis.socket.getAdapterInstances((err, instances) => {\r\n\t\t\t\r\n\t\t\tlet states = [];\r\n\t\t\tif (instances && instances.rows) {\r\n\t\t\t\tlet adapters = [];\r\n\t\t\t\t\r\n\t\t\t\t// states per instance to retrieve\r\n\t\t\t\tinstances.rows.forEach((instance, i) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\t// get alive / connected states\r\n\t\t\t\t\tif ((!this.list || (this.list && this.list.indexOf(instance.value.common.name) > -1)) && (!this.blacklist || (this.blacklist && this.blacklist.indexOf(instance.value.common.name) === -1))) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tadapters.push(instance);\r\n\t\t\t\t\t\tstates = states.concat([\r\n\t\t\t\t\t\t\tinstance.id + '.alive',\r\n\t\t\t\t\t\t\tinstance.id + '.connected',\r\n\t\t\t\t\t\t\tinstance.id.replace('system.adapter.', '') + '.info.connection'\r\n\t\t\t\t\t\t]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// sort instances\r\n\t\t\t\tthis.setState({ adapterInformation: adapters.sort((item1, item2) => {\r\n\t\t\t\t\t\tif (item1.id > item2.id) return 1;\r\n\t\t\t\t\t\telse if (item2.id > item1.id) return -1;\r\n\t\t\t\t\t\telse return 0;\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// retrieve intial states\r\n\t\t\t\tthis.socket.getStates(states, (id, adapterAliveStatus) => {\r\n\t\t\t\t\tthis.setState({ adapterAliveStatus });\r\n\t\t\t\t\t\r\n\t\t\t\t\t// get state updates\r\n\t\t\t\t\tthis.socket.subscribeStates(states, (id, aliveStatus) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (aliveStatus && (!this.state.adapterAliveStatus[id] || (aliveStatus.val !== this.state.adapterAliveStatus[id].val))) {\r\n\t\t\t\t\t\t\tthis.setState(prevState => ({ adapterAliveStatus: { ...prevState.adapterAliveStatus, [id]: aliveStatus } }));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tconst { classes } = this.props;\r\n\t\t\r\n\t\t// adapter updates\r\n\t\tconst updateList = (this.state.adapterUpdates && this.state.adapterUpdates.val && JSON.parse(this.state.adapterUpdates.val)) || {};\r\n\t\tconst updates = Object.keys(updateList).length\r\n\t\t\r\n\t\t// adapter instances\r\n\t\tlet adapterList = <ListItem key='loading' className={classes.loading}><CircularProgress size={20} /></ListItem>\r\n\t\t\r\n\t\tif (this.state.adapterInformation.length > 0) {\r\n\t\t\t\r\n\t\t\tadapterList = this.state.adapterInformation.map(adapter => {\r\n\t\t\t\tadapter.update = updateList[adapter.value.common.name] || false;\r\n\t\t\t\t\r\n\t\t\t\tconst enabled = adapter.value.common.enabled;\r\n\t\t\t\tconst alive = (this.state.adapterAliveStatus[adapter.id + '.alive'] && this.state.adapterAliveStatus[adapter.id + '.alive'].val) || false;\r\n\t\t\t\tconst connected = (this.state.adapterAliveStatus[adapter.id + '.connected'] && this.state.adapterAliveStatus[adapter.id + '.connected'].val) || false;\r\n\t\t\t\tconst connection = this.state.adapterAliveStatus[adapter.id.replace('system.adapter.', '') + '.info.connection'] ? this.state.adapterAliveStatus[adapter.id.replace('system.adapter.', '') + '.info.connection'].val : true;\r\n\t\t\t\t\r\n\t\t\t\tconst tooltip = i18n.t('Adapter') + ' ' + (enabled ? (alive && connected && connection ? i18n.t('alive') : i18n.t('not alive')) : i18n.t('disabled'));\r\n\t\t\t\t\r\n\t\t\t\treturn (\r\n\t\t\t\t\r\n\t\t\t\t\t<ListItem key={'adapter-' + adapter.id}>\r\n\t\t\t\t\t\t<ListItemAvatar>\r\n\t\t\t\t\t\t\t<Avatar alt={adapter.value.common.name} src={adapter.value.common.extIcon} className={classes.small} />\r\n\t\t\t\t\t\t</ListItemAvatar>\r\n\t\t\t\t\t\t<ListItemText\r\n\t\t\t\t\t\t\tprimary={adapter.value.common.title}\r\n\t\t\t\t\t\t\tsecondary={[\r\n\t\t\t\t\t\t\t\t'v' + adapter.value.common.version,\r\n\t\t\t\t\t\t\t\t(adapter.update && (<span key={'updates-' + adapter.id}>, <span className={classes.UpdateAvailable}>{i18n.t('Update available') + ' v' + adapter.update.availableVersion}</span></span>)),\r\n\t\t\t\t\t\t\t\t(adapter.value.common.runAsCompactMode && ', ' + i18n.t('Compact Mode') + ' ' + i18n.t('on') + ' (' + i18n.t('Group') + ' ' + adapter.value.common.compactGroup + ')')\r\n\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<ListItemSecondaryAction className={clsx(classes.StatusIndicator, enabled ? (alive && connected && connection ? classes.alive : classes.notAlive) : classes.disabled)}>\r\n\t\t\t\t\t\t\t<Tooltip title={tooltip}>\r\n\t\t\t\t\t\t\t\t<span className={enabled ? (alive && connected && connection ? 'mdi mdi-check-circle' : 'mdi mdi-alert') : 'mdi mdi-close'}></span>\r\n\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t</ListItemSecondaryAction>\r\n\t\t\t\t\t</ListItem>\r\n\t\t\t\t\r\n\t\t\t\t)\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\treturn (\r\n\r\n<List dense>\r\n\t{updates > 0 &&\r\n\t<ListItem key=\"updates\" classes={{ container: classes.UpdatesListItem }}>\r\n\t\t<ListItemAvatar>\r\n\t\t\t<StarIcon />\r\n\t\t</ListItemAvatar>\r\n\t\t<ListItemText\r\n\t\t\tprimary={i18n.t('Updates available') + '!'}\r\n\t\t\t/>\r\n\t\t\r\n\t\t<ListItemSecondaryAction className={clsx(classes.StatusIndicator, classes.UpdatesIndicator)}>\r\n\t\t\t{updates}\r\n\t\t</ListItemSecondaryAction>\r\n\t</ListItem>\r\n\t}\r\n\t\r\n\t{adapterList}\r\n</List>\r\n\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport const Settings = {\r\n\tnoDevicesAllowed: true,\r\n\ttitle: i18n.t('Adapter Status'),\r\n\ticon: 'traffic-light'\r\n}\r\n\r\nexport default withStyles(styles)(AdapterStatus);\r\n","import React from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport { Line } from 'react-chartjs-2'\r\n// eslint-disable-next-line\r\nimport chartjs_colorschemes from 'chartjs-plugin-colorschemes'\r\n// eslint-disable-next-line\r\nimport chartjs_zoom from 'chartjs-plugin-zoom'\r\n\r\nimport deLocale from 'date-fns/locale/de'\r\nimport DateFnsUtils from '@date-io/date-fns'\r\n\r\nimport i18n from '../i18n'\r\nimport helpers from '../helpers/timeConverter'\r\n\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport Button from '@material-ui/core/Button'\r\nimport ButtonGroup from '@material-ui/core/ButtonGroup'\r\nimport Alert from '@material-ui/lab/Alert'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Paper from '@material-ui/core/Paper'\r\nimport Divider from '@material-ui/core/Divider'\r\nimport { MuiPickersUtilsProvider, DateTimePicker } from '@material-ui/pickers'\r\nimport InputBase from '@material-ui/core/InputBase'\r\nimport Select from '@material-ui/core/Select'\r\nimport MenuItem from '@material-ui/core/MenuItem'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport CalendarIcon from '@material-ui/icons/Event'\r\nimport CalendarTodayIcon from '@material-ui/icons/EventAvailable'\r\nimport HistoryIcon from '@material-ui/icons/History'\r\nimport FastRewindIcon from '@material-ui/icons/FastRewind'\r\n//import DisablePan from '@material-ui/icons/SelectAll'\r\n//import DisableZoom from '@material-ui/icons/LocationDisabled'\r\nimport ResetZoom from '@material-ui/icons/ZoomOutMap'\r\nimport LiveUpdates from '@material-ui/icons/Update'\r\n\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { withStyles } from '@material-ui/core/styles';\r\nconst styles = theme => ({\r\n\tloading: {\r\n\t\tposition: 'absolute',\r\n\t\tbackgroundColor: 'rgba(0, 0, 0, 0.3)',\r\n\t\twidth: '100%',\r\n\t\theight: '100%',\r\n\t\tdisplay: 'flex',\r\n\t\talignItems: 'center',\r\n\t\tjustifyContent: 'center',\r\n\t},\r\n\terrorMessage: {\r\n\t\tmarginBottom: 5,\r\n\t\tmarginRight: 15,\r\n\t\twidth: '100%'\r\n\t},\r\n\ttoolbar: {\r\n\t\tdisplay: 'flex'\r\n\t},\r\n\ttoolbarButtons: {\r\n\t\tdisplay: 'initial',\r\n\t\twhiteSpace: 'nowrap'\r\n\t},\r\n\toptions: {\r\n\t\tdisplay: 'flex',\r\n\t\tjustifyContent: 'center',\r\n\t},\r\n\tdatePicker: {\r\n\t\tpadding: '2px 4px',\r\n\t\tdisplay: 'flex',\r\n\t\talignItems: 'center',\r\n\t\tmargin: 2\r\n\t},\r\n\tinput: {\r\n\t\tmarginLeft: theme.spacing(1),\r\n\t\tflex: 1,\r\n\t},\r\n\tselect: {\r\n\t\twidth: 100\r\n\t},\r\n\ticon: {\r\n\t\tmargin: 10,\r\n\t},\r\n\ticonButton: {\r\n\t\tpadding: 10,\r\n\t},\r\n\tdivider: {\r\n\t\tmargin: '15px 0',\r\n\t},\r\n\tdividerVertical: {\r\n\t\theight: 28,\r\n\t\tmargin: 4,\r\n\t},\r\n\tbutton: {\r\n\t\tbackgroundColor: theme.palette.primary.main,\r\n\t\tcolor: '#fff !important',\r\n\t\tmargin: '4px'\r\n\t},\r\n\tbuttonDisabled: {\r\n\t\tbackgroundColor: '#eee',\r\n\t\tmargin: '4px'\r\n\t}\r\n});\r\n\r\n\r\nclass Chart extends React.Component {\r\n\t\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t\r\n\t\t// chart settings\r\n\t\tthis.chartFilter = this.props.settings.chartFilter || {};\r\n\t\tthis.chartConfig = this.props.settings.chartConfig || {};\r\n\t\t\r\n\t\tthis.chartConfig.yAxes = this.chartConfig.yAxes || [];\r\n\t\tthis.chartConfig.yAxes.unshift({\r\n\t\t\tid: 'left',\r\n\t\t\ttype: 'linear',\r\n\t\t\tposition: 'left',\r\n\t\t\tticks: {\r\n\t\t\t\tcallback: value => (this.chartConfig.yLeftAxisUnitBefore || '') + Number.parseFloat(value).toFixed(1) + (this.chartConfig.yLeftAxisUnitAfter || '')\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t// states\r\n\t\tthis.state = {\r\n\t\t\tloading: true,\r\n\t\t\terrors: [],\r\n\t\t\t\r\n\t\t\tdatePicker: false,\r\n\t\t\tselectedTimeRangeValue: (this.chartFilter && this.chartFilter.selectedTimeRangeValue) || 1,\r\n\t\t\tselectedTimeRangeUnit: (this.chartFilter && this.chartFilter.selectedTimeRangeUnit) || 'days',\r\n\t\t\tselectedDateTime: (this.chartFilter && this.chartFilter.selectedDateTime && new Date(this.chartFilter.selectedDateTime)) || new Date(),\r\n\t\t\tdateNow: this.chartFilter && this.chartFilter.selectedDateTime ? false : true,\r\n\t\t\t\r\n\t\t\tchartLabels: [],\r\n\t\t\tchartData: {\r\n\t\t\t\tlabels: [],\r\n\t\t\t\tdatasets: []\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tchartPan: true,\r\n\t\t\tchartZoom: true\r\n\t\t}\r\n\t\t\r\n\t\t//\r\n\t\tthis.timer = null;\r\n\t\tthis.timeRangeRef = React.createRef();\r\n\t\t\r\n\t\t// chart instance options\r\n\t\tthis.chartRef = React.createRef();\r\n\t\tthis.chartUpdates = {};\r\n\t\tthis.chartOptions = {\r\n\t\t\tmaintainAspectRatio: false,\r\n\t\t\tspanGaps: true,\r\n\t\t\tlegend: {\r\n\t\t\t\tonClick: this.legendClickHandler.bind(this)\r\n\t\t\t},\r\n\t\t\ttooltips: {\r\n\t\t\t\tcallbacks: {\r\n\t\t\t\t\tlabel: (item, data) => data.datasets[item.datasetIndex].label + ': ' + item.value + data.datasets[item.datasetIndex].unit\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tscales: {\r\n\t\t\t\tyAxes: this.chartConfig.yAxes\r\n\t\t\t},\r\n\r\n\t\t\tplugins: {\r\n\t\t\t\tcolorschemes: {\r\n\t\t\t\t\tscheme: 'brewer.SetOne9'\r\n\t\t\t\t},\r\n\t\t\t\tzoom: {\r\n\t\t\t\t\t// Container for pan options\r\n\t\t\t\t\tpan: {\r\n\t\t\t\t\t\t// Boolean to enable panning\r\n\t\t\t\t\t\tenabled: true,\r\n\r\n\t\t\t\t\t\t// Panning directions\r\n\t\t\t\t\t\tmode: 'xy'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Container for zoom options\r\n\t\t\t\t\tzoom: {\r\n\t\t\t\t\t\t// Boolean to enable zooming\r\n\t\t\t\t\t\tenabled: true,\r\n\r\n\t\t\t\t\t\t// Zooming directions.\r\n\t\t\t\t\t\tmode: 'xy'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\t\r\n\tcomponentDidMount() {\r\n\t\t\r\n\t\t// request initial history data\r\n\t\tlet options = { ...this.getTimeRange(), axis: this.getAxis() };\r\n\t\t\r\n\t\tthis.props.devices.forEach(device => {\r\n\t\t\tdevice.label = device.name + ' (' + i18n.t(device.primaryStateKey) + ')';\r\n\t\t\tdevice.requestDeviceStateHistory(device.options.history || null, true, { 'start': options.start, 'end': options.end, 'step': options.step, 'aggregate': 'average', 'ignoreNull': true }).catch(err => {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// add listeners for newly requested data\r\n\t\t\tdevice.on('historyChange', (stateKey, history, state) => {\r\n\t\t\t\t\r\n\t\t\t\tthis.addChartGraph(device, history, { ...options, axis: this.getAxis(options.start, options.end) } );\r\n\t\t\t\tthis.setState({ loading: false });\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// add listeners for data updates\r\n\t\t\tif (this.props.settings.liveUpdates !== null && this.props.settings.liveUpdates !== false && this.state.dateNow) {\r\n\t\t\t\t\r\n\t\t\t\tdevice.on('stateChange', (stateKey, val, state) => this.updateChartGraph(device, val, { ...options, axis: this.getAxis(options.end, new Date()) } ));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\t\r\n\t\tif (this.state.selectedTimeRangeValue &&\r\n\t\t\t\t(prevState.selectedDateTime !== this.state.selectedDateTime || prevState.selectedTimeRangeValue !== this.state.selectedTimeRangeValue || prevState.selectedTimeRangeUnit !== this.state.selectedTimeRangeUnit)\r\n\t\t\t) {\r\n\t\t\t\r\n\t\t\t// request updated history data\r\n\t\t\tthis.setState({ loading: true, errors: [] });\r\n\t\t\t\r\n\t\t\tclearTimeout(this.timer);\r\n\t\t\tthis.timer = setTimeout(() => {\r\n\t\t\t\t\r\n\t\t\t\tconst options = this.getTimeRange();\r\n\t\t\t\tthis.props.devices.forEach(device => {\r\n\t\t\t\t\tdevice.requestDeviceStateHistory(device.options.history || null, true, { 'start': options.start, 'end': options.end, 'step': options.step, 'aggregate': 'average', 'ignoreNull': true }).catch(err => {\r\n\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t}, 500);\r\n\t\t}\r\n\t}\r\n\t\r\n\tgetTimeRange() {\r\n\t\t\r\n\t\tconst end = this.state.selectedDateTime.getTime();\r\n\t\tlet timeRange = this.state.selectedTimeRangeValue;\r\n\t\tlet step = 1;\r\n\t\tlet axisTimeFormat = 'dd. MMM yyyy, HH:mm';\r\n\t\t\r\n\t\tswitch(this.state.selectedTimeRangeUnit) {\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'seconds':\r\n\t\t\t\taxisTimeFormat = 'dd. MMM yyyy, HH:mm:ss';\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase 'minutes':\r\n\t\t\t\taxisTimeFormat = 'dd. MMM yyyy, HH:mm:ss';\r\n\t\t\t\ttimeRange = timeRange*60;\r\n\t\t\t\t//step = step;\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase 'hours':\r\n\t\t\t\taxisTimeFormat = 'dd. MMM yyyy, HH:mm';\r\n\t\t\t\ttimeRange = timeRange*60*60;\r\n\t\t\t\tstep = step*60;\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase 'days':\r\n\t\t\t\taxisTimeFormat = 'dd. MMM yyyy, HH:mm';\r\n\t\t\t\ttimeRange = timeRange*60*60*24;\r\n\t\t\t\tstep = step*60*60;\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase 'months':\r\n\t\t\t\taxisTimeFormat = 'dd. MMM yyyy';\r\n\t\t\t\ttimeRange = timeRange*60*60*24*31;\r\n\t\t\t\tstep = step*60*60*24;\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase 'years':\r\n\t\t\t\taxisTimeFormat = 'dd. MMM yyyy';\r\n\t\t\t\ttimeRange = timeRange*60*60*24*365;\r\n\t\t\t\tstep = step*60*60*24*31;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t\r\n\t\treturn {\r\n\t\t\t'axisTimeFormat': axisTimeFormat,\r\n\t\t\t'start': end-timeRange*1000,\r\n\t\t\t'end': end,\r\n\t\t\t'timeRange': timeRange*1000,\r\n\t\t\t'step': step*1000\r\n\t\t};\r\n\t}\r\n\t\r\n\tgetAxis(start, end) {\r\n\t\t\r\n\t\tconst { step, axisTimeFormat } = this.getTimeRange();\r\n\t\tlet axis = {};\r\n\t\t\r\n\t\tfor (let time = start; time <= end; time += step) {\r\n\t\t\taxis[time] = helpers.secondsToDateTime(time/1000, axisTimeFormat);\r\n\t\t}\r\n\t\t\r\n\t\treturn axis;\r\n\t}\r\n\t\r\n\tgroupChartData(chartData, axis) {\r\n\t\t\r\n\t\tlet prevMarker;\r\n\t\tlet data = [];\r\n\t\t\r\n\t\tlet markers = Object.keys(axis);\r\n\t\tmarkers.forEach((marker, i) => {\r\n\t\t\tprevMarker = markers[(i-1 > 0 ? i-1 : 0)];\r\n\t\t\t\r\n\t\t\tfor (let index in chartData) {\r\n\t\t\t\tlet entry = chartData[index];\r\n\t\t\t\tentry.val = parseFloat(entry.val);\r\n\t\t\t\t\r\n\t\t\t\t// \r\n\t\t\t\tif (!entry.ts || entry.val === null) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// before range, continue\r\n\t\t\t\tif (prevMarker > entry.ts) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// in range\r\n\t\t\t\telse if (prevMarker < entry.ts && entry.ts <= marker) {\r\n\t\t\t\t\tdata[i] = !data[i] ? [ entry.val ] : [ ...data[i], entry.val ]; // parseFloat((data[i] ? ((data[i]+entry.val)/2) : entry.val).toFixed(2));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// beyond range, so next marker\r\n\t\t\t\telse if (entry.ts > marker) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//\r\n\t\t\tif (!data[i]) {\r\n\t\t\t\t// \r\n\t\t\t}\r\n\t\t\telse if (data[i].length === 1) {\r\n\t\t\t\tdata[i] = data[i][0];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdata[i] = data[i].reduce((a,b) => a + b, 0) / data[i].length;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn data;\r\n\t}\r\n\t\r\n\tupdateChartGraph(device, value, options) {\r\n\t\t\r\n\t\tconst chartIndex = this.state.chartLabels.findIndex(entry => entry === device.label);\r\n\t\tif (chartIndex === -1) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tthis.chartUpdates[chartIndex] = this.chartUpdates[chartIndex] || [];\r\n\t\tthis.chartUpdates[chartIndex].push({\r\n\t\t\t'ts': value.ts,\r\n\t\t\t'val': value.val\r\n\t\t});\r\n\t\t\r\n\t\t// process data\r\n\t\tconst data = this.groupChartData(this.chartUpdates[chartIndex], options.axis);\r\n\t\t\r\n\t\t//console.log(value);\r\n\t\t//console.log(options, options.axis, data);\r\n\t\t\r\n\t\t// update chart\r\n\t\tthis.chartRef.current.chartInstance.data.labels = [ ...this.state.chartData.labels, ...Object.values(options.axis) ];\r\n\t\tthis.chartRef.current.chartInstance.data.datasets[chartIndex].data = [ ...this.state.chartData.datasets[chartIndex].data, ...data ];\r\n\t\tthis.chartRef.current.chartInstance.update();\r\n\t}\r\n\t\r\n\taddChartGraph(device, history, options) {\r\n\t\t\r\n\t\t// only add chart if data is given\r\n\t\tif (!history || !history.length) {\r\n\t\t\tlet error = i18n.t('No history data given for %s').replace('%s', device.label) + '!';\r\n\t\t\tthis.setState(prevStates => ({ errors: [ ...prevStates.errors, error ] }));\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t// process data\r\n\t\tconst data = this.groupChartData(history, options.axis);\r\n\t\t\r\n\t\t// update chart\r\n\t\tconst chartIndex = this.state.chartLabels.findIndex(entry => entry === device.label);\r\n\t\tif (chartIndex > -1) {\r\n\t\t\tthis.chartRef.current.chartInstance.data.labels = Object.values(options.axis);\r\n\t\t\tthis.chartRef.current.chartInstance.data.datasets[chartIndex].data = data;\r\n\t\t\tthis.chartRef.current.chartInstance.update();\r\n\t\t}\r\n\t\t\r\n\t\t// index chart\r\n\t\telse {\r\n\t\t\tthis.setState(prevStates => ({ chartLabels: [ ...prevStates.chartLabels, device.label ] }));\r\n\t\t\t\r\n\t\t\t// chart dataset\r\n\t\t\tlet dataSet = {\r\n\t\t\t\tlabel: device.label,\r\n\t\t\t\tunit: device.states[device.primaryStateKey].state.value.unit || '',\r\n\t\t\t\tfill: false,\r\n\t\t\t\t...device.options.graphConfig || {},\r\n\t\t\t\tdata: data\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// add data to chart\r\n\t\t\tthis.setState(prevStates => ({\r\n\t\t\t\taxisTimeFormat: options.axisTimeFormat,\r\n\t\t\t\tchartData: {\r\n\t\t\t\t\tlabels: Object.values(options.axis),\r\n\t\t\t\t\tdatasets: [ ...prevStates.chartData.datasets, dataSet ],\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\t\r\n\tlegendClickHandler(e, legendItem) {\r\n\t\t\r\n\t\tlet index = legendItem.datasetIndex;\r\n\t\tlet ci = this.chartRef.current.chartInstance;\r\n\t\tlet meta = ci.getDatasetMeta(index);\r\n\r\n\t\tmeta.hidden = meta.hidden === null ? !ci.data.datasets[index].hidden : null;\r\n\t\tci.update();\r\n\t\tci.resetZoom();\r\n\t}\r\n\t\r\n\tdisablePan() {\r\n\t\tlet pan = this.chartRef.current.chartInstance.options.plugins.zoom.pan.enabled;\r\n\t\tthis.chartRef.current.chartInstance.options.plugins.zoom.pan.enabled = (pan === false);\r\n\t\tthis.setState({ chartPan: (pan === false) });\r\n\t}\r\n\t\r\n\tdisableZoom() {\r\n\t\tlet zoom = this.chartRef.current.chartInstance.options.plugins.zoom.zoom.enabled;\r\n\t\tthis.chartRef.current.chartInstance.options.plugins.zoom.zoom.enabled = (zoom === false);\r\n\t\tthis.setState({ chartZoom: (zoom === false) });\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tconst { classes, settings } = this.props;\r\n\t\treturn (\r\n\r\n<div>\r\n\t<div className={classes.options}>\r\n\t\r\n\t\t<Paper className={classes.datePicker}>\r\n\t\t\t<Tooltip title={i18n.t('Period shown in Chart')}>\r\n\t\t\t\t<HistoryIcon className={classes.icon} />\r\n\t\t\t</Tooltip>\r\n\t\t\t\r\n\t\t\t<InputBase\r\n\t\t\t\tinputRef={this.timeRangeRef}\r\n\t\t\t\tclassName={classes.input}\r\n\t\t\t\tvalue={this.state.selectedTimeRangeValue}\r\n\t\t\t\tonChange={event => this.setState({ selectedTimeRangeValue: event.target.value })}\r\n\t\t\t\t/>\r\n\t\t\t\r\n\t\t\t<Select\r\n\t\t\t\tvalue={this.state.selectedTimeRangeUnit}\r\n\t\t\t\tonChange={event => this.setState({ selectedTimeRangeUnit: event.target.value })}\r\n\t\t\t\tdisplayEmpty\r\n\t\t\t\tdisableUnderline\r\n\t\t\t\tclassName={classes.select}\r\n\t\t\t\t>\r\n\t\t\t\t\r\n\t\t\t\t<MenuItem value=\"seconds\">{i18n.t('Seconds')}</MenuItem>\r\n\t\t\t\t<MenuItem value=\"minutes\">{i18n.t('Minutes')}</MenuItem>\r\n\t\t\t\t<MenuItem value=\"hours\">{i18n.t('Hours')}</MenuItem>\r\n\t\t\t\t<MenuItem value=\"days\">{i18n.t('Days')}</MenuItem>\r\n\t\t\t\t<MenuItem value=\"months\">{i18n.t('Months')}</MenuItem>\r\n\t\t\t\t<MenuItem value=\"years\">{i18n.t('Years')}</MenuItem>\r\n\t\t\t</Select>\r\n\t\t\t\r\n\t\t\t{/*\r\n\t\t\t<IconButton className={classes.iconButton} onClick={() => this.timeRangeRef.current.focus()}>\r\n\t\t\t\t<CalendarIcon />\r\n\t\t\t</IconButton>\r\n\t\t\t*/}\r\n\t\t</Paper>\r\n\r\n\t\t<Paper className={classes.datePicker}>\r\n\t\t\t<Tooltip title={i18n.t('End date')}>\r\n\t\t\t\t<FastRewindIcon className={classes.icon} />\r\n\t\t\t</Tooltip>\r\n\t\t\t\r\n\t\t\t<MuiPickersUtilsProvider locale={deLocale} utils={DateFnsUtils}>\r\n\t\t\t\t<DateTimePicker\r\n\t\t\t\t\tclassName={classes.input}\r\n\t\t\t\t\tvalue={this.state.selectedDateTime}\r\n\t\t\t\t\tonChange={selectedDateTime => this.setState({ selectedDateTime: selectedDateTime, dateNow: false })}\r\n\t\t\t\t\t\r\n\t\t\t\t\topen={this.state.datePicker}\r\n\t\t\t\t\tonOpen={() => this.setState({ datePicker: true })}\r\n\t\t\t\t\tonClose={() => this.setState({ datePicker: false })}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvariant=\"inline\"\r\n\t\t\t\t\tampm={false}\r\n\t\t\t\t\tformat='dd.MM.yyyy HH:mm'\r\n\t\t\t\t\tInputProps={{\r\n\t\t\t\t\t\tdisableUnderline: true,\r\n\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t\r\n\t\t\t</MuiPickersUtilsProvider>\r\n\t\t\t\r\n\t\t\t<Tooltip title={i18n.t('Select end date')}>\r\n\t\t\t\t<IconButton color=\"primary\" className={classes.iconButton} onClick={() => this.setState({ datePicker: true })}>\r\n\t\t\t\t\t<CalendarIcon />\r\n\t\t\t\t</IconButton>\r\n\t\t\t</Tooltip>\r\n\t\t\t<Divider className={classes.dividerVertical} orientation=\"vertical\" />\r\n\t\t\t<Tooltip title={i18n.t('Select today as end date')}>\r\n\t\t\t\t<IconButton className={classes.iconButton} onClick={() => this.setState({ selectedDateTime: new Date(), dateNow: true })}>\r\n\t\t\t\t\t<CalendarTodayIcon />\r\n\t\t\t\t</IconButton>\r\n\t\t\t</Tooltip>\r\n\t\t</Paper>\r\n\t\r\n\t\t<Button className={clsx(classes.datePicker, this.props.settings.liveUpdates !== null && this.props.settings.liveUpdates !== false && this.state.dateNow ? classes.button : classes.buttonDisabled)} disabled={true}>\r\n\t\t\t<Tooltip title={i18n.t('Indicates whether live updates are turn on or off.')}>\r\n\t\t\t\t\t<LiveUpdates />\r\n\t\t\t</Tooltip>\r\n\t\t</Button>\r\n\t\t\r\n\t</div>\r\n\t<Divider className={classes.divider} />\r\n\t\r\n\t<div className={classes.toolbar}>\r\n\t\t<div className={classes.errorMessage}>\r\n\t\t\t{this.state.errors.length > 0 && <Alert severity=\"error\">{this.state.errors.map((error, i) => [ error, React.createElement('br', { key: 'br-error-' + i }) ])}</Alert>}\r\n\t\t</div>\r\n\t\t\r\n\t\t<ButtonGroup className={classes.toolbarButtons} color=\"primary\">\r\n\t\t{/*\r\n\t\t\t<Button disableElevation={true} variant={this.state.chartPan ? 'contained' : 'outlined'} onClick={this.disablePan.bind(this)}>\r\n\t\t\t\t<Tooltip title={i18n.t(this.state.chartPan ? 'Disable panning' : 'Enable panning')}>\r\n\t\t\t\t\t<DisablePan />\r\n\t\t\t\t</Tooltip>\r\n\t\t\t</Button>\r\n\t\t\t<Button disableElevation={true} variant={this.state.chartZoom ? 'contained' : 'outlined'} onClick={this.disableZoom.bind(this)}>\r\n\t\t\t\t<Tooltip title={i18n.t(this.state.chartZoom ? 'Disable Zoom' : 'Enable Zoom')}>\r\n\t\t\t\t\t<DisableZoom />\r\n\t\t\t\t</Tooltip>\r\n\t\t\t</Button>\r\n\t\t*/}\r\n\t\t\t<Button disableElevation={true} variant=\"contained\" onClick={() => this.chartRef.current.chartInstance.resetZoom()}>\r\n\t\t\t\t<Tooltip title={i18n.t('Reset Zoom')}>\r\n\t\t\t\t\t<ResetZoom />\r\n\t\t\t\t</Tooltip>\r\n\t\t\t</Button>\r\n\t\t</ButtonGroup>\r\n\t</div>\r\n\t\r\n\t<div className={'chart-container'} style={{ position: 'relative', height: settings.chartHeight || '500px' }}>\r\n\t\t{this.state.loading && <div className={classes.loading}>\r\n\t\t\t<CircularProgress />\r\n\t\t</div>}\r\n\t\t\r\n\t\t<Line\r\n\t\t\tref={this.chartRef}\r\n\t\t\tdata={this.state.chartData}\r\n\t\t\toptions={this.chartOptions}\r\n\t\t\t/>\r\n\t\t\t\r\n\t</div>\r\n</div>\r\n\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default withStyles(styles)(Chart);\r\n","import React, { useState, useEffect, useRef } from 'react'\r\nimport Connection from '../Connection'\r\n\r\nimport { format } from 'date-fns'\r\nimport { de } from 'date-fns/locale'\r\nimport { getSunrise, getSunset } from 'sunrise-sunset-js'\r\n\r\nimport i18n from '../i18n'\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\n\r\n\r\nexport default function DateTime(props) {\r\n\tconst { settings } = props;\r\n\t\r\n\tconst refTimer = useRef();\r\n\tconst [DateTime, setDateTime] = useState(format(new Date(), settings.format, { locale: de }));\r\n\tconst [city, setCity] = useState('');\r\n\tconst [sunrise, setSunrise] = useState('');\r\n\tconst [sunset, setSunset] = useState('');\r\n\t\r\n\t// https://date-fns.org/v2.9.0/docs/format\r\n\tsettings.style = { fontSize: '1.5rem', textAlign: 'center', ...settings.style };\r\n\tsettings.format = settings.format || 'dd.MM.yyyy HH:mm:ss';\r\n\tsettings.refresh = settings.format.indexOf('s') > -1 ? 1000 : (settings.format.indexOf('i') > -1 ? 60*1000 : 60*60*1000);\r\n\t\r\n\tuseEffect(() => {\r\n\t\tclearTimeout(refTimer.current);\r\n\t\trefTimer.current = setTimeout(() => setDateTime(format(new Date(), settings.format, { locale: de })), settings.refresh);\r\n\t\t\r\n\t\t// get coordinates\r\n\t\tConnection.getConnection.getObject('system.config', (err, data) => {\r\n\t\t\t\r\n\t\t\tif (!city && data && data.common) {\r\n\t\t\t\tif (data.common.latitude && data.common.longitude) {\r\n\t\t\t\t\tsetSunrise(getSunrise(data.common.latitude, data.common.longitude));\r\n\t\t\t\t\tsetSunset(getSunset(data.common.latitude, data.common.longitude));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (data.common.city) {\r\n\t\t\t\t\tsetCity(data.common.city);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t}, [city]);\r\n\t\r\n\treturn (\r\n\r\n<div style={settings.style}>\r\n\t{i18n.t('%DateTime').replace(/%DateTime/, DateTime)}\r\n\t\r\n\t{settings.sun !== false && <p style={{ margin: '5px 0', fontSize: '1.2rem' }}>\r\n\t\t<span className=\"mdi mdi-weather-sunset-up\"></span> {sunrise ? format(sunrise, 'HH:mm') : <CircularProgress size=\"1.2rem\" />}\r\n\t\t<span style={{ margin: '0 10px' }}></span>\r\n\t\t<span className=\"mdi mdi-weather-sunset-down\"></span> {sunset ? format(sunset, 'HH:mm') : <CircularProgress size=\"1.2rem\" />}\r\n\t</p>\r\n\t}\r\n</div>\r\n\r\n\t);\r\n}\r\n\r\nexport const Settings = {\r\n\tnoDevicesAllowed: true,\r\n\ttitle: i18n.t('Time'),\r\n\ticon: 'clock-outline'\r\n}\r\n","import React, { useState, useEffect, useRef, useCallback } from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport L from 'leaflet'\r\nimport { Map as LeafletMap, TileLayer, Marker as LeafletMarker, Tooltip as LeafletTooltip } from 'react-leaflet'\r\n\r\nimport i18n from '../i18n'\r\nimport Box from '@material-ui/core/Box'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Avatar from '@material-ui/core/Avatar'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\tmap: {\r\n\t\twidth: '100%',\r\n\t\theight: '100%'\r\n\t},\r\n\tmapOverview: {\r\n\t\tcolor: '#666',\r\n\t\tposition: 'absolute',\r\n\t\tleft: 0,\r\n\t\tbottom: 0,\r\n\t\twidth: '100%',\r\n\t\theight: '60px',\r\n\t\tzIndex: 999,\r\n\t\tdisplay: 'flex',\r\n\t\talignItems: 'center',\r\n\t\t\r\n\t\t'& > *': {\r\n\t\t\tmargin: theme.spacing(1),\r\n\t\t\tcursor: 'pointer',\r\n\t\t},\r\n\t},\r\n\t/*\r\n\t * MARKER WITH ICON\r\n\t *\r\n\tmapIconContainer: {\r\n\t\tbackgroundImage: 'url(\"https://unpkg.com/leaflet@1.6.0/dist/images/marker-icon-2x.png\")',\r\n\t\tbackgroundSize: '100% 100%'\r\n\t},\r\n\tmapIconParent: {\r\n\t\tbackgroundColor: '#fff',\r\n\t\tborderRadius: '10px',\r\n\t\theight: '20px',\r\n\t\twidth: '20px',\r\n\t\tmargin: '3px auto',\r\n\t\ttextAlign: 'center'\r\n\t},\r\n\tmapIcon: {\r\n\t\tfontSize: '1.2rem',\r\n\t\tdisplay: 'block',\r\n\t\tmargin: '-4px 0 0 1px',\r\n\t\tcolor: '#f00',\r\n\t\tposition: 'absolute'\r\n\t}\r\n\t*/\r\n\tmapIconContainer: {\r\n\t},\r\n\tmapIconParent: {\r\n\t\tbackgroundColor: '#fff',\r\n\t\tboxShadow: '0 0 0 8px rgba(255, 255, 255, 0.3)',\r\n\t\tborderRadius: '50%',\r\n\t\twidth: '100%',\r\n\t\theight: '100%'\r\n\t},\r\n\tmapIcon: {\r\n\t\tfontSize: '2rem',\r\n\t\tcolor: theme.palette.primary.main,\r\n\t\ttransform: 'translate3d(4px, -4px,0)', /* for fontSize: '2.3rem' -> 'translate3d(2px, -8px,0)', */\r\n\t\tdisplay: 'block',\r\n\t\t\r\n\t\t'&:after': {\r\n\t\t\tcontent: '\"\"',\r\n\t\t\tdisplay: 'block',\r\n\t\t\tpadding: '50% 0%'\r\n\t\t}\r\n\t},\r\n\tmapTooltip: {\r\n\t}\r\n}));\r\n\r\n\r\nexport default function Map(props) {\r\n\tconst { settings, devices } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\tconst [zoom,] = useState(settings.component.defaultZoom);\r\n\tconst [position,] = useState(Array.isArray(settings.component.defaultPosition) ? settings.component.defaultPosition : settings.component.defaultPosition.split(','));\r\n\tconst [markers, setMarkers] = useState({});\r\n\t\r\n\t// map instance\r\n\tconst map = useRef();\r\n\tconst memoizedMapInitialised = useCallback(function() {map.current = this}, [],);\r\n\t\r\n\t// Marker click in overview\r\n\tconst memoizedHandleClick = useCallback(flyTo => map.current.flyTo(flyTo.split(',')), [],);\r\n\t\r\n\t// get gps position coordinates\r\n\tuseEffect(() => {\r\n\t\tdevices.forEach(device => {\r\n\t\t\t\r\n\t\t\t// request device state\r\n\t\t\tdevice.requestDeviceState('position').catch(err => {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t\t\r\n\t\t\t\tsetMarkers(prevMarkers => {\r\n\t\t\t\t\tif (!prevMarkers[device.id]) {\r\n\t\t\t\t\t\treturn { ...prevMarkers, [device.id]: null };\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn prevMarkers;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// listen for updates\r\n\t\t\tdevice.on('stateChange', (stateKey, state) => {\r\n\t\t\t\t\r\n\t\t\t\tif (stateKey === 'position') {\r\n\t\t\t\t\t\r\n\t\t\t\t\tsetMarkers(prevMarkers => {\r\n\t\t\t\t\t\tif (!prevMarkers[device.id] || prevMarkers[device.id].position !== state.val) {\r\n\t\t\t\t\t\t\tdevice.options.position = state.val;\r\n\t\t\t\t\t\t\treturn { ...prevMarkers, [device.id]: device };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn prevMarkers;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\r\n\t}, [devices]);\r\n\t\r\n\t// add markers\r\n\tlet mapMarkers = [], mapOverview = [];\r\n\tif (devices.length > 0 && devices.length === Object.keys(markers).length) {\r\n\t\t\r\n\t\tfor (let key in markers) {\r\n\t\t\tlet device = markers[key];\r\n\t\t\tif (device !== null) {\r\n\t\t\t\tlet marker = <Marker key={'marker-' + device.id} position={device.options.position} device={device} settings={settings.component} />\r\n\t\t\t\tmapMarkers.push(marker);\r\n\t\t\t\t\r\n\t\t\t\tlet item = null;\r\n\t\t\t\tif (device.attributes.avatar) {\r\n\t\t\t\t\titem = <Avatar key={'overview-' + device.id} alt={device.name} src={device.attributes.avatar} onClick={() => memoizedHandleClick(device.options.position)} />\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconst icon = device.getIcon('position');\r\n\t\t\t\t\titem = <Avatar key={'overview-' + device.id} alt={device.name} onClick={() => memoizedHandleClick(device.options.position)}><span className={clsx('mdi mdi-' + icon)}></span></Avatar>\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tmapOverview.push(<Tooltip key={'tooltip-' + device.id} title={device.name} aria-label={device.name} arrow>{item}</Tooltip>);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn (\r\n\r\n<React.Fragment>\r\n\t<Box className={classes.mapOverview}>\r\n\t\t<Typography>{i18n.t('Jump to')}:</Typography>\r\n\t\t{mapOverview}\r\n\t</Box>\r\n\t<LeafletMap useFlyTo={true} center={position} zoom={zoom} className={classes.map} whenReady={memoizedMapInitialised}>\r\n\t\t<TileLayer\r\n\t\t\tattribution='&amp;copy <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n\t\t\turl='https://{s}.tile.osm.org/{z}/{x}/{y}.png'\r\n\t\t\t/>\r\n\t\t\r\n\t\t{mapMarkers}\r\n\t</LeafletMap>\r\n</React.Fragment>\r\n\r\n\t);\r\n}\r\n\r\n\r\nfunction Marker(props) {\r\n\tconst { position, device, settings } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\tlet markerIcon = null, offset = 40;\r\n\tconsole.info('Marker for ' + device.function + ' ' + device.name + ' added to map.');\r\n\t\r\n\t// Marker with avatar / picture\r\n\tif (device.attributes && device.attributes.avatar && device.attributes.avatar.substr(0, 11) === 'data:image/') {\r\n\t\tmarkerIcon = L.divIcon({\r\n\t\t\tclassName: classes.mapIconContainer,\r\n\t\t\thtml: '<img src=\"' + device.attributes.avatar + '\" class=\"' + classes.mapIconParent + '\" />',\r\n\t\t\ticonSize: [ 64, 64 ]\r\n\t\t});\r\n\t}\r\n\t\r\n\t// Marker with Icon\r\n\telse {\r\n\t\toffset = 30;\r\n\t\tconst icon = device.getIcon('position');\r\n\t\t\r\n\t\tmarkerIcon = L.divIcon({\r\n\t\t\tclassName: classes.mapIconContainer,\r\n\t\t\thtml: '<div class=\"' + classes.mapIconParent + '\"><span class=\"' + clsx(classes.mapIcon, 'mdi mdi-' + icon) + '\"></span></div>',\r\n\t\t\ticonSize: [ 40, 40 ]\r\n\t\t});\r\n\t}\r\n\t\r\n\t// Marker MouseOver / MouseOut (bring tooltip to front if markers overlay)\r\n\tconst memoizedHandleMouseEvent = useCallback(function() {this.closeTooltip().openTooltip()}, [],);\r\n\r\n\treturn (\r\n\r\n<LeafletMarker riseOnHover={true} position={Array.isArray(position) ? position : position.split(',')} icon={markerIcon} onMouseOver={memoizedHandleMouseEvent}>\r\n\t<LeafletTooltip className={classes.mapTooltip} direction={settings.tooltipDirection || 'bottom'} permanent={settings.tooltipPermanent || true} offset={[0,offset]}>\r\n\t\t{device.name}\r\n\t</LeafletTooltip>\r\n</LeafletMarker>\r\n\r\n\t);\r\n}","import React from 'react'\r\n\r\nimport StateList from './StateList'\r\n\r\n\r\nexport default function StateListHorizontal(props) {\r\n\treturn (<StateList horizontal={true} {...props} />);\r\n}\r\n","import React, { useState, useEffect } from 'react'\r\n\r\nimport Connection from '../Connection'\r\nimport i18n from '../i18n'\r\n\r\nimport Grid from '@material-ui/core/Grid'\r\nimport Paper from '@material-ui/core/Paper'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\tpaper: {\r\n\t\twidth: 100,\r\n\t\theight: 160,\r\n\t\tpadding: 5,\r\n\t\ttextAlign: 'center',\r\n\t}\r\n}));\r\n\r\n\r\nexport default function Weather(props) {\r\n\tconst { settings } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\tconst [data,setData] = useState(null);\r\n\tuseEffect(() => {\r\n\t\t\r\n\t\tConnection.getConnection.getRemoteResource(settings.url).then(\r\n\t\t\tresponse => {\r\n\t\t\t\t\r\n\t\t\t\tif (response.statusCode === 200) {\r\n\t\t\t\t\tsetData(JSON.parse(response.body));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror => console.error(error)\r\n\t\t);\r\n\t\t\r\n\t}, [settings.url]);\r\n\t\r\n\tlet weatherForecast = [];\r\n\t//console.log(data);\r\n\t\r\n\tif (!data) {\r\n\t\treturn null;\r\n\t}\r\n\telse {\r\n\t\tfor (let day in data.day) {\r\n\t\t\tlet forecast = data.day[day];\r\n\t\t\tforecast.title = day === 1 ? i18n.t('today') : (day === 2 ? i18n.t('tomorrow') : forecast.name);\r\n\t\t\t\r\n\t\t\tconst dailyForecast = (\r\n\r\n<Grid key={'day-' + day} item>\r\n\t<Paper className={classes.paper}>\r\n\t\t<Typography variant=\"body1\">\r\n\t\t\t{forecast.title}\r\n\t\t</Typography>\r\n\t\t<Typography variant=\"caption\">\r\n\t\t\t{forecast.date}\r\n\t\t</Typography>\r\n\r\n\r\n\t</Paper>\r\n</Grid>\r\n\r\n\t\t\t);\r\n\t\t\t\r\n\t\t\tweatherForecast.push(dailyForecast);\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn (\r\n\r\n<Grid container justify=\"space-between\" spacing={1}>\r\n\t{weatherForecast}\r\n\t\r\n</Grid>\r\n\r\n\t);\r\n}\r\n\r\nexport const Settings = {\r\n\tnoDevicesAllowed: true,\r\n\ttitle: i18n.t('Weather'),\r\n\ticon: 'weather-partly-cloudy'\r\n}\r\n","import React from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport helpers from '../helpers/timeConverter'\r\n\r\nimport Divider from '@material-ui/core/Divider'\r\n//import IconButton from '@material-ui/core/IconButton'\r\nimport Fab from '@material-ui/core/Fab'\r\nimport PlayIcon from '@material-ui/icons/PlayArrow'\r\nimport PauseIcon from '@material-ui/icons/Pause'\r\nimport StopIcon from '@material-ui/icons/Stop'\r\nimport SkipPreviousIcon from '@material-ui/icons/SkipPrevious'\r\nimport SkipNextIcon from '@material-ui/icons/SkipNext'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { withStyles } from '@material-ui/core/styles';\r\nconst styles = theme => ({\r\n\tdivider: {\r\n\t\tmargin: '15px -16px'\r\n\t},\r\n\tcontainer: {\r\n\t\tmargin: theme.spacing(0, -2),\r\n\t},\r\n\tnoHeader: {\r\n\t\tmarginTop: theme.spacing(-4),\r\n\t},\r\n\timage: {\r\n\t\theight: '200px',\r\n\t\tdisplay: 'flex',\r\n\t\talignItems: 'flex-end',\r\n\t\tbackgroundPosition: 'center',\r\n\t\tcursor: 'pointer'\r\n\t},\r\n\tnoImage: {\r\n\t\tbackgroundColor: theme.palette.primary.main,\r\n\t\tdisplay: 'flex',\r\n\t\tcursor: 'pointer'\r\n\t},\r\n\tinformation: {\r\n\t\tbackgroundColor: theme.palette.primary.main + '66',\r\n\t\tcolor: '#fff',\r\n\t\tpadding: '10px',\r\n\t\tmargin: 0,\r\n\t\twidth: '100%',\r\n\t\tminHeight: '45px'\r\n\t},\r\n\tinformationLeft: {\r\n\t\twidth: '80%',\r\n\t\tfloat: 'left',\r\n\t\tmargin: 0\r\n\t},\r\n\tinformationRight: {\r\n\t\twidth: '19%',\r\n\t\tfloat: 'right',\r\n\t\tmargin: 0,\r\n\t\ttextAlign: 'right'\r\n\t},\r\n\tlength: {\r\n\t\tbackgroundColor: theme.palette.primary.main,\r\n\t\twidth: '100%',\r\n\t\theight: '7px',\r\n\t},\r\n\tlengthBar: {\r\n\t\tbackgroundColor: theme.palette.secondary.main,\r\n\t\theight: '100%',\r\n\t},\r\n\tcontrols: {\r\n\t\tdisplay: 'flex',\r\n\t\talignItems: 'stretch'\r\n\t},\r\n\tcontrolsBox: {\r\n\t\tdisplay: 'flex',\r\n\t\tjustifyContent: 'center',\r\n\t\talignItems: 'center',\r\n\t\tpaddingTop: '30px'\r\n\t},\r\n\tcontrolsBoxLeft: {\r\n\t\tflex: 1,\r\n\t\tflexDirection: 'column',\r\n\t\talignItems: 'baseline'\r\n\t},\r\n\tcontrolsBoxCenter: {\r\n\t\tflex: 3\r\n\t},\r\n\tcontrolsBoxRight: {\r\n\t\tflex: 1,\r\n\t\tjustifyContent: 'end'\r\n\t},\r\n\tcontrolButton: {\r\n\t\tmargin: '0 5px'\r\n\t},\r\n\tcontrolButtonSmall: {\r\n\t\tmargin: '0 10px',\r\n\t\tfontSize: '1.2rem',\r\n\t\theight: '32px',\r\n\t\twidth: '32px'\r\n\t}\r\n});\r\n\r\n\r\nclass Multimedia extends React.Component {\r\n\t\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t\r\n\t\tthis.state = {}\r\n\t}\r\n\t\r\n\tcomponentDidMount() {\r\n\t\t\r\n\t\t// get initial states\r\n\t\tfor (let stateKey in this.props.device.states) {\r\n\t\t\tthis.props.device.requestDeviceState(stateKey, true).catch(err => console.error(err));\r\n\t\t}\r\n\t\t\r\n\t\t// receive updates\r\n\t\tthis.props.device.on('stateChange', (stateKey, state) => {\r\n\t\t\t\r\n\t\t\t// duration\r\n\t\t\tif (stateKey === 'duration' && state && state.val.indexOf(':') === -1) {\r\n\t\t\t\tstate.val = helpers.timeToHoursMinutesSeconds(state.val);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// isRunning\r\n\t\t\tif (stateKey === 'isRunning' && state && typeof state.val === 'string') {\r\n\t\t\t\tstate.val = state.val.indexOf('play') > -1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.setState({ [stateKey]: state }, () => {\r\n\t\t\t\tthis.progress();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\tprogress() {\r\n\t\tclearTimeout(this.progressTimeout);\r\n\t\t\r\n\t\tif (this.state.isRunning && this.state.isRunning.val === true && this.state.progress && this.state.progress.val && this.state.duration && this.state.duration.val) {\r\n\t\t\tthis.progressTimeout = setTimeout(() => {\r\n\t\t\t\tthis.setState(prevState => ({ progress: { ...prevState.progress, val: helpers.timeToSeconds(prevState.progress.val) + 1 }}), () => this.progress());\r\n\t\t\t}, 1000);\r\n\t\t}\r\n\t}\r\n\t\r\n\topenDialog() {\r\n\t\tthis.props.openDialog(this.props.device);\r\n\t}\r\n\t\r\n\tsetDeviceState(stateKey, value) {\r\n\t\tthis.props.device.setDeviceState(stateKey, value).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tconst { classes, noHeader, index, device } = this.props;\r\n\t\tlet styleImage = {}, styleLength = {}, styleLengthBar = {};\r\n\t\t\r\n\t\t// background\r\n\t\tif (this.state.background && this.state.background.val !== '') {\r\n\t\t\tstyleImage.backgroundImage = 'url(' + ((device.options.backgroundUrlPrepend || '') + this.state.background.val) + ')';\r\n\t\t}\r\n\t\t\r\n\t\t// duration\r\n\t\tif (this.state.duration && this.state.duration.val) {\r\n\t\t\tstyleLengthBar.width = ((this.state.progress && this.state.progress.val) || 0) + 'px';\r\n\t\t}\r\n\t\t\r\n\t\tconst playIconElements = this.state.isRunning && this.state.isRunning.val ? [<PauseIcon onClick={this.setDeviceState.bind(this, 'pause', true)} />, <StopIcon />] : [<PlayIcon onClick={this.setDeviceState.bind(this, 'play', true)} />];\r\n\t\t//const repeatIcon = 'repeat'; // repeat, repeat-off, repeat-once\r\n\t\t//const shuffleIcon = 'shuffle-variant'; // shuffle-variant, shuffle-disabled\r\n\t\t//const volumeIcon = 'volume-high'; // volume-variant-off\r\n\t\t\r\n\t\treturn (\r\n\r\n<React.Fragment>\r\n\t\r\n\t{index > 0 && <Divider className={classes.divider} />}\r\n\t<div className={clsx(classes.container, noHeader && classes.noHeader)}>\r\n\t\t\r\n\t\t<div className={clsx(this.state.background && this.state.background.val !== '' ? classes.image : classes.noImage)} style={ styleImage } onClick={this.openDialog.bind(this)}>\r\n\t\t\t\r\n\t\t\t<div className={classes.information}>\r\n\t\t\t\t<p className={classes.informationLeft}>\r\n\t\t\t\t\t{this.state.grandParent && this.state.grandParent.val && [this.state.grandParent.val, <br key={'br-' + device.id} />]}\r\n\t\t\t\t\t{this.state.parent && this.state.parent.val && this.state.parent.val + ' - '}{this.state.title && this.state.title.val}\r\n\t\t\t\t</p>\r\n\t\t\t\t<p className={classes.informationRight}>\r\n\t\t\t\t\t{this.state.progress && helpers.timeToHoursMinutesSeconds(this.state.progress.val)} / {this.state.duration && this.state.duration.val}\r\n\t\t\t\t</p>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t</div>\r\n\t\t<div className={classes.length} style={ styleLength }>\r\n\t\t\t<div className={classes.lengthBar} style={ styleLengthBar }></div>\r\n\t\t</div>\r\n\t\t\r\n\t\t<div className={classes.controls}>\r\n\t\t\t<div className={clsx(classes.controlsBox, classes.controlsBoxLeft)}>\r\n\t\t\t\t{/*\r\n\t\t\t\t<IconButton size=\"small\" className={classes.controlButtonSmall}>\r\n\t\t\t\t\t<span className={'mdi mdi-' + repeatIcon}></span>\r\n\t\t\t\t</IconButton>\r\n\t\t\t\t<IconButton size=\"small\" className={classes.controlButtonSmall}>\r\n\t\t\t\t\t<span className={'mdi mdi-' + shuffleIcon}></span>\r\n\t\t\t\t</IconButton>\r\n\t\t\t\t*/}\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t<div className={clsx(classes.controlsBox, classes.controlsBoxCenter)}>\r\n\t\t\t\t\r\n\t\t\t\t<Fab className={classes.controlButton} size=\"small\" color=\"secondary\">\r\n\t\t\t\t\t<SkipPreviousIcon onClick={this.setDeviceState.bind(this, 'previous', true)} />\r\n\t\t\t\t</Fab>\r\n\t\t\t\t\r\n\t\t\t\t{playIconElements.map((icon, i) => \r\n\t\t\t\t<Fab key={'icon-' + i} className={classes.controlButton} size=\"large\" color=\"primary\">\r\n\t\t\t\t\t{icon}\r\n\t\t\t\t</Fab>\r\n\t\t\t\t)}\r\n\t\t\t\t\r\n\t\t\t\t<Fab className={classes.controlButton} size=\"small\" color=\"secondary\">\r\n\t\t\t\t\t<SkipNextIcon onClick={this.setDeviceState.bind(this, 'next', true)} />\r\n\t\t\t\t</Fab>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t<div className={clsx(classes.controlsBox, classes.controlsBoxRight)}>\r\n\t\t\t\t{/*\r\n\t\t\t\t<IconButton size=\"small\" className={classes.controlButtonSmall}>\r\n\t\t\t\t\t<span className={'mdi mdi-' + volumeIcon}></span>\r\n\t\t\t\t</IconButton>\r\n\t\t\t\t*/}\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t\r\n\t</div>\r\n\r\n</React.Fragment>\r\n\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default withStyles(styles)(Multimedia);\r\n","import React from 'react'\r\n\r\nimport MultimediaItem from './MultimediaItem'\r\n\r\n\r\nexport default function StateList(props) {\r\n\tconst { devices, settings } = props;\r\n\treturn devices.map((device, i) => <MultimediaItem key={'MultimediaItem-' + device.id} {...props} index={i} noHeader={i === 0 && settings.icon === null && settings.title === null} device={device} />)\r\n}\r\n","var map = {\n\t\"./de.js\": 331,\n\t\"./en.js\": 332\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 330;","export default {\r\n\t/*\r\n\t * LOADING SCREEN\r\n\t */\r\n\t\"Retrieving settings\": \"Einstellungen werden geladen\",\r\n\t\r\n\t/*\r\n\t * GENERAL\r\n\t */\r\n\t\"on\": \"an\",\r\n\t\"off\": \"aus\",\r\n\t\r\n\t\"user\": \"User\",\r\n\t\"users\": \"Users\",\r\n\t\r\n\t\"door\": \"Tür\",\r\n\t\"window\": \"Fenster\",\r\n\t\r\n\t\"open\": \"offen\",\r\n\t\"closed\": \"geschlossen\",\r\n\t\r\n\t\"turn on\": \"anschalten\",\r\n\t\"power\": \"Geräte Status\",\r\n\t\"trigger\": \"Geräte Status\",\r\n\t\r\n\t\"brightness\": \"Helligkeit\",\r\n\t\"wind\": \"Wind\",\r\n\t\"battery\": \"Batterie\",\r\n\t\r\n\t\"%DateTime\": \"%DateTime Uhr\",\r\n\t\"boost\": \"Boost\",\r\n\t\r\n\t/*\r\n\t * BLINDS\r\n\t */\r\n\t\"blind#level\": \"Behanghöhe\",\r\n\t\"blind#level2\": \"Lamellenposition\",\r\n\t\r\n\t\r\n\t/*\r\n\t * LIGHT\r\n\t */\r\n\t\"light#power\": \"Licht\",\r\n\t\"light#level\": \"Helligkeit\",\r\n\t\"colorTemperature\": \"Farbtemperatur\",\r\n\t\"hue\": \"Farbe\",\r\n\t\"light#rgb\": \"Farbraum Rot-Grün-Blau (RGB)\",\r\n\t\"hex\": \"Farbe\",\r\n\t\r\n\t\r\n\t/*\r\n\t * HEATING\r\n\t */\r\n\t\"temperature\": \"Temperatur\",\r\n\t\"humidity\": \"Luftfeuchtigkeit\",\r\n\t\"setTemperature\": \"eingestellte Temperatur\",\r\n\t\r\n\t\r\n\t/*\r\n\t * DOOR\r\n\t */\r\n\t\"bell\": \"Klingel\",\r\n\t\"lock\": \"Schloß\",\r\n\t\"presence\": \"Präsenz\",\r\n\t\r\n\t\r\n\t/*\r\n\t * HOUSEHOLD\r\n\t */\r\n\t\"running\": \"Gerät läuft\",\r\n\t\"consumption\": \"Verbrauch\"\r\n}","export default {\r\n\t/*\r\n\t * LIGHT\r\n\t */\r\n\t\"level\": \"Brightness\",\r\n\t\"colorTemperature\": \"Color Temperature\",\r\n\t\"hue\": \"Color\",\r\n\t\"color\": \"Color\",\r\n\t\"hex\": \"Color\",\r\n}","\r\nexport default {\r\n\tconfigurations: {\r\n\t\topen: {\r\n\t\t\ticon: {\r\n\t\t\t\t'true': 'door-open',\r\n\t\t\t\t'false': 'door-closed'\r\n\t\t\t},\r\n\t\t\tstate: {\r\n\t\t\t\t'true': 'open',\r\n\t\t\t\t'false': 'closed'\r\n\t\t\t},\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t},\r\n\tactions: {\r\n\t},\r\n\tstyles: {\r\n\t}\r\n}","import React from 'react'\r\n\r\nimport defaults from './defaults'\r\n\r\n\r\n/*\r\n * COMPONENTS\r\n *\r\n */\r\nfunction HeatingSetTemperatureComponent(props) {\r\n\tconst Level = defaults.components.LevelComponent;\r\n\treturn (\r\n\t\t<Level min={0} max={35} {...props} />\r\n\t);\r\n}\r\n\r\n\r\n\r\nexport default {\r\n\tconfigurations: {\r\n\t\ttemperature: {\r\n\t\t\tvalue: (val) => val.toFixed(1),\r\n\t\t\tunit: ' °C'\r\n\t\t},\r\n\t\tsetTemperature: {\r\n\t\t\tunit: ' °C',\r\n\t\t\ticon: 'thermometer-chevron-up'\r\n\t\t},\r\n\t\thumidity: {\r\n\t\t\tunit: ' %'\r\n\t\t},\r\n\t\tboost: {\r\n\t\t\ticon: 'radiator'\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t\tsetTemperature: HeatingSetTemperatureComponent\r\n\t},\r\n\tactions: {\r\n\t\tboost: defaults.actions.PowerAction\r\n\t},\r\n\tstyles: {\r\n\t}\r\n}","import React, { useState, useEffect } from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport i18n from '../i18n'\r\n\r\nimport Slider from '@material-ui/core/Slider'\r\nimport Switch from '@material-ui/core/Switch'\r\nimport Button from '@material-ui/core/Button'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles, withStyles } from '@material-ui/core/styles';\r\nconst styles = theme => ({\r\n\tprimaryAction: props => ({\r\n\t\t...props.styles\r\n\t}),\r\n\tsecondaryAction: props => ({\r\n\t\tcolor: '#999',\r\n\t\tfontSize: '14px',\r\n\t\t...props.styles\r\n\t}),\r\n});\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n\tcomponent: {\r\n\t\tpadding: theme.spacing(2, 8, 2, 2)\r\n\t},\r\n\tsliderMarkLabel: {\r\n\t\t[theme.breakpoints.down('md')]: {\r\n\t\t\tdisplay: 'none',\r\n\t\t\t'&:nth-child(5)': { display: 'block' },\r\n\t\t\t'&:nth-child(15)': { display: 'block' },\r\n\t\t\t'&:nth-child(25)': { display: 'block' }\r\n\t\t}\r\n\t}\r\n}));\r\n\r\n\r\n/*\r\n * ACTIONS\r\n *\r\n */\r\nconst Action = withStyles(styles)(props => {\r\n\tconst { classes, device, state, stateKey } = props;\r\n\treturn (\r\n\r\n<span className={clsx((stateKey === device.primaryStateKey && classes.primaryAction) || (stateKey === device.secondaryStateKey && classes.secondaryAction))}>\r\n\t{state.value} {state.unit}\r\n</span>\r\n\r\n\t);\r\n});\r\n\r\nfunction PowerAction(props) {\r\n\tconst { device, stateKey, stateVal, onChange: parentOnChange } = props;\r\n\t\r\n\tconst onChange = (e) => {\r\n\t\tsetChecked(e.target.checked);\r\n\t\tdevice.setDeviceState(stateKey, e.target.checked).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\tconst [checked, setChecked] = useState(stateVal);\r\n\tuseEffect(() => setChecked(stateVal), [stateVal]);\r\n\t\r\n\treturn (\r\n\r\n<Switch\r\n\tchecked={checked}\r\n\tonChange={parentOnChange || onChange}\r\n\tvalue={checked !== true}\r\n\tcolor=\"primary\"\r\n\t/>\r\n\r\n\t);\r\n}\r\n\r\nfunction TriggerAction(props) {\r\n\tconst { device, stateKey, stateVal } = props;\r\n\t\r\n\tconst onClick = () => {\r\n\t\tdevice.setDeviceState(stateKey, true).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\t//\r\n\tif (stateVal === true || stateVal > 0) {\r\n\t\treturn <Action {...props} onChange={null} />;\r\n\t}\r\n\t\r\n\tconst icon = 'power';\r\n\treturn (\r\n\r\n<Button\r\n\tvariant=\"outlined\"\r\n\tcolor=\"primary\"\r\n\tsize=\"small\"\r\n\tstartIcon={<span className={'mdi mdi-' + icon}></span>}\r\n\tonClick={onClick}\r\n\t>\r\n\t\r\n\t{i18n.t('turn on')}\r\n</Button>\r\n\r\n\t);\r\n}\r\n\r\n\r\n/*\r\n * COMPONENTS\r\n *\r\n */\r\nfunction Label(props) {\r\n\tconst { label, br } = props;\r\n\tconst linebreak = br || false;\r\n\t\r\n\treturn (\r\n\t\r\n<React.Fragment>\r\n\t{label}\r\n\t{linebreak && <br />}\r\n</React.Fragment>\r\n\t\r\n\t);\r\n}\r\n\r\nfunction Component(props) {\r\n\tconst { title, children } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\treturn (\r\n\r\n<React.Fragment>\r\n\t<Label label={title} />\r\n\t<div className={classes.component}>\r\n\t\t{children}\r\n\t\r\n\t</div>\r\n</React.Fragment>\r\n\r\n\t);\r\n}\r\n\r\nfunction LevelComponent(props) {\r\n\tlet { device, stateKey, stateVal, title, min, max, step, markSteps } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\tconst onChange = (e, val) => {\r\n\t\tsetLevel(val);\r\n\t\tdevice.setDeviceState(stateKey, val).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\tconst [level, setLevel] = useState(stateVal);\r\n\tuseEffect(() => setLevel(stateVal), [stateVal]);\r\n\t\r\n\t// default settings\r\n\tmin = min || 0;\r\n\tmax = max || 100;\r\n\tstep = step || 1;\r\n\tmarkSteps = markSteps || 11; // 0 to 10\r\n\tlet markStep = ((max-min)/(markSteps-1)) || 10;\r\n\treturn (\r\n\r\n<Component title={title || stateKey }>\r\n\t<Slider\r\n\t\tclasses={{ markLabel: classes.sliderMarkLabel }}\r\n\t\t//onChange\r\n\t\tonChangeCommitted={onChange}\r\n\t\tdefaultValue={level}\r\n\t\tvalueLabelDisplay=\"auto\"\r\n\t\tmarks={[...Array(markSteps).keys()].map(number => ({ 'value': min+number*markStep, 'label': min+number*markStep }))}\r\n\t\tmin={min}\r\n\t\tmax={max}\r\n\t\tstep={step}\r\n\t/>\r\n\r\n</Component>\r\n\r\n\t);\r\n}\r\n\r\n\r\n\r\nexport default {\r\n\tconfigurations: {\r\n\t\t_any: {\r\n\t\t\tvalue: (val) => val.toString(),\r\n\t\t\t//unit\r\n\t\t\t//icon\r\n\t\t\t//state\r\n\t\t},\r\n\t\tbattery: {\r\n\t\t\tunit: ' %',\r\n\t\t\ticon: 'battery-medium'\r\n\t\t},\r\n\t\tdoor: {\r\n\t\t\ticon: {\r\n\t\t\t\t'true': 'door-open',\r\n\t\t\t\t'false': 'door-closed'\r\n\t\t\t},\r\n\t\t\tstate: {\r\n\t\t\t\t'true': 'open',\r\n\t\t\t\t'false': 'closed'\r\n\t\t\t},\r\n\t\t},\r\n\t\thumidity: {\r\n\t\t\tunit: ' %',\r\n\t\t\ticon: 'water-percent'\r\n\t\t},\r\n\t\tlevel: {\r\n\t\t\tunit: ' %'\r\n\t\t},\r\n\t\tposition: {\r\n\t\t\ticon: 'map-marker'\r\n\t\t},\r\n\t\tpower: {\r\n\t\t\tstate: {\r\n\t\t\t\t'true': 'on',\r\n\t\t\t\t'false': 'off'\r\n\t\t\t},\r\n\t\t\ticon: 'power'\r\n\t\t},\r\n\t\ttemperature: {\r\n\t\t\tunit: ' °C',\r\n\t\t\ticon: 'thermometer'\r\n\t\t},\r\n\t\ttrigger: {\r\n\t\t\tstate: {\r\n\t\t\t\t'true': 'on',\r\n\t\t\t\t'false': 'off'\r\n\t\t\t},\r\n\t\t\ticon: 'power'\r\n\t\t},\r\n\t\twind: {\r\n\t\t\tunit: ' km/h',\r\n\t\t\ticon: 'weather-windy'\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t\tLabel,\r\n\t\tComponent,\r\n\t\tLevelComponent,\r\n\t\t\r\n\t\tlevel: LevelComponent\r\n\t},\r\n\tactions: {\r\n\t\tAction,\r\n\t\tPowerAction,\r\n\t\tTriggerAction,\r\n\t\t\r\n\t\tpower: PowerAction,\r\n\t\ttrigger: TriggerAction\r\n\t},\r\n\tstyles: {\r\n\t\t_any: {\r\n\t\t\t//icon: {},\r\n\t\t\tstate: {\r\n\t\t\t\t'true': {\r\n\t\t\t\t\t'color': '#090',\r\n\t\t\t\t\t'fontWeight': 'bold'\r\n\t\t\t\t},\r\n\t\t\t\t'false': {\r\n\t\t\t\t\t'color': '#999'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}","\r\nexport default {\r\n\tconfigurations: {\r\n\t\tposition: {\r\n\t\t\ticon: 'home'\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t},\r\n\tactions: {\r\n\t},\r\n\tstyles: {\r\n\t}\r\n}","\r\nexport default {\r\n\tconfigurations: {\r\n\t\tposition: {\r\n\t\t\ticon: 'account'\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t},\r\n\tactions: {\r\n\t},\r\n\tstyles: {\r\n\t}\r\n}","\r\nexport default {\r\n\tconfigurations: {\r\n\t\topen: {\r\n\t\t\ticon: {\r\n\t\t\t\t'true': 'window-open-variant',\r\n\t\t\t\t'false': 'window-closed-variant'\r\n\t\t\t},\r\n\t\t\tstate: {\r\n\t\t\t\t'true': 'open',\r\n\t\t\t\t'false': 'closed'\r\n\t\t\t},\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t},\r\n\tactions: {\r\n\t},\r\n\tstyles: {\r\n\t}\r\n}","import React from 'react'\r\n\r\nimport Grid from '@material-ui/core/Grid'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\tgridContainer: {\r\n\t\tpaddingLeft: theme.spacing(1),\r\n\t\t[theme.breakpoints.down('md')]: {\r\n\t\t\tpaddingLeft: theme.spacing(0.4)\r\n\t\t}\r\n\t}\r\n}));\r\n\r\n\r\nexport default function GridContainer(props) {\r\n\tconst { contents = {} } = props;\r\n\t\r\n\tconst classes = useStyles();\r\n\tconst columns = Object.keys(contents).length;\r\n\t\r\n\tlet grid = [];\r\n\tfor (let column = 1; column <= columns; column++) {\r\n\t\t\r\n\t\tif (!contents[column]) {\r\n\t\t\tconsole.warn('No content for column #' + column + '!');\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t\r\n\t\tgrid.push(\r\n\t\t\t<Grid key={column} item\t\t\t\t// @see https://material-ui.com/customization/breakpoints/\r\n\t\t\t\txs={12}\t\t\t\t\t\t\t//    0 -  600px\r\n\t\t\t\tsm={6}\t\t\t\t\t\t\t//  600 -  960px\r\n\t\t\t\tmd={6}\t\t\t\t\t\t\t//  960 - 1280px\r\n\t\t\t\tlg={Math.round(12/columns)}\t\t// 1280 - 1920px\r\n\t\t\t\txl={Math.round(12/columns)}\t\t// \t\t> 1920px\r\n\t\t\t\t>\r\n\t\t\t\t\r\n\t\t\t\t{contents[column]}\r\n\t\t\t</Grid>\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn (\r\n\r\n<Grid container spacing={0} className={classes.gridContainer}>\r\n\t{grid}\r\n</Grid>\r\n\r\n\t);\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\n\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\r\nimport IconButton from '@material-ui/core/IconButton';\r\n\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle';\r\nimport WarningIcon from '@material-ui/icons/Warning';\r\nimport ErrorIcon from '@material-ui/icons/Error';\r\nimport InfoIcon from '@material-ui/icons/Info';\r\n\r\n\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { amber, green } from '@material-ui/core/colors';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\tsuccess: {\r\n\t\tbackgroundColor: green[600],\r\n\t},\r\n\terror: {\r\n\t\tbackgroundColor: theme.palette.error.dark,\r\n\t},\r\n\tinfo: {\r\n\t\tbackgroundColor: theme.palette.primary.main,\r\n\t},\r\n\twarning: {\r\n\t\tbackgroundColor: amber[700],\r\n\t},\r\n\ticon: {\r\n\t\tfontSize: 20,\r\n\t},\r\n\ticonVariant: {\r\n\t\topacity: 0.9,\r\n\t\tmarginRight: theme.spacing(1),\r\n\t},\r\n\tmessage: {\r\n\t\tdisplay: 'flex',\r\n\t\talignItems: 'center',\r\n\t},\r\n}));\r\n\r\n\r\nconst variantIcon = {\r\n\tsuccess: CheckCircleIcon,\r\n\twarning: WarningIcon,\r\n\terror: ErrorIcon,\r\n\tinfo: InfoIcon,\r\n};\r\n\r\n\r\nexport default function StatusSnackbar(props) {\r\n\tconst classes = useStyles();\r\n\tlet { className, open, autoHideDuration, message, closeButton, onClose, variant, ...other } = props;\r\n\tconst Icon = variantIcon[variant];\r\n\t\r\n\topen = open || true;\r\n\tautoHideDuration = autoHideDuration || null;\r\n\treturn (\r\n\r\n<Snackbar\r\n\tanchorOrigin={{\r\n\t\tvertical: 'bottom',\r\n\t\thorizontal: 'center',\r\n\t}}\r\n\topen={open}\r\n\tautoHideDuration={autoHideDuration}\r\n\tonClose={onClose}\r\n\t>\r\n\t<SnackbarContent\r\n\t\tclassName={clsx(classes[variant], className)}\r\n\t\tmessage={\r\n\t\t\t<span id=\"client-snackbar\" className={classes.message}>\r\n\t\t\t\t<Icon className={clsx(classes.icon, classes.iconVariant)} />\r\n\t\t\t\t{message}\r\n\t\t\t</span>\r\n\t\t}\r\n\t\taction={closeButton && [\r\n\t\t\t<IconButton key=\"close\" aria-label=\"close\" color=\"inherit\" onClick={onClose}>\r\n\t\t\t\t<CloseIcon className={classes.icon} />\r\n\t\t\t</IconButton>,\r\n\t\t]}\r\n\t\t{...other}\r\n\t\t/>\r\n\t\t\r\n</Snackbar>\r\n\r\n\t);\r\n}","\r\nexport default {\r\n\tdefaults: require('./defaults').default,\r\n\t\r\n\tblind: require('./blind').default,\r\n\tdoor: require('./door').default,\r\n\theating: require('./heating').default,\r\n\tjalousie: require('./blind').default,\r\n\tlight: require('./light').default,\r\n\tlocation: require('./location').default,\r\n\tuser: require('./user').default,\r\n\twindow: require('./window').default\r\n}","import EventEmitter from 'events'\r\nimport functions from './functions'\r\n\r\n\r\n/**\r\n * Function\r\n *\r\n * @param\t{String}\t\tfunctionType\r\n * @return\t{Function}\r\n *\r\n */\r\nexport default class Function extends EventEmitter {\r\n\t\r\n\tconstructor(functionType) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis.function = functionType;\r\n\t\t\r\n\t\tif (!this.function) {\t\r\n\t\t\tthrow new Error('No function given!');\r\n\t\t}\r\n\t\t\r\n\t\tthis.functionId = this.function.toLowerCase();\r\n\t\t\r\n\t\t// configuration\r\n\t\tthis.defaults = functions['defaults'].configurations;\r\n\t\tthis.configurations = (functions[this.functionId] && functions[this.functionId].configurations) || {};\r\n\t\t\r\n\t\t// styles\r\n\t\tthis.defaultStyles = functions['defaults'].styles;\r\n\t\tthis.styles = (functions[this.functionId] && functions[this.functionId].styles) || {};\r\n\t\t\r\n\t\t// components and actions\r\n\t\tthis.components = { ...functions['defaults'].components, ...(functions[this.functionId] && functions[this.functionId].components) || {} };\r\n\t\tthis.actions = { ...functions['defaults'].actions, ...(functions[this.functionId] && functions[this.functionId].actions) || {} };\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @return\t{Mixed}\r\n\t * @private\r\n\t */\r\n\t_applyFunction(key, val) {\r\n\t\treturn this._isFunction(key) ? key(val) : val;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @return\t{String}\r\n\t * @private\r\n\t */\r\n\t_getValueFromSettings(settings, defaults = '') {\r\n\t\t\r\n\t\tfor (let key in settings) {\r\n\t\t\tif (settings[key] !== undefined) {\r\n\t\t\t\treturn settings[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn defaults;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @return\t{Boolean}\r\n\t * @private\r\n\t */\r\n\t_isFunction(key) {\r\n\t\treturn key && typeof key === 'function';\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @return\t{Boolean}\r\n\t * @private\r\n\t */\r\n\t_isValue(val) {\r\n\t\treturn val !== undefined; // || val === null || val === false; // null is considered a value, so it can be used to actually null the output\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @return\t{Object}\r\n\t * @private\r\n\t */\r\n\t_setObjectStructure(obj, defaultValue = undefined) {\r\n\t\t\r\n\t\tif (!obj || typeof obj != 'object') {\r\n\t\t\tobj = { 'default': obj || defaultValue };\r\n\t\t}\r\n\t\telse if (typeof obj == 'object' && !obj.default) {\r\n\t\t\tobj.default = defaultValue;\r\n\t\t}\r\n\t\t\r\n\t\treturn obj;\r\n\t}\r\n}\r\n","export default {\r\n\t\"hm-rpc\": \"HomeMatic\",\r\n}","import React from 'react'\r\nimport i18n from './i18n'\r\nimport Function from './Function'\r\nimport Adapters from './Adapters'\r\n\r\nimport { formatDistanceToNow } from 'date-fns'\r\nimport { de } from 'date-fns/locale'\r\n\r\n\r\n/**\r\n * Device\r\n *\r\n * @param\t{Object}\tdeviceProperties\r\n * @param\t{String}\tdeviceProperties.id\r\n * @param\t{String}\tdeviceProperties.name\r\n * @param\t{String}\t[deviceProperties.room=null]\r\n * @param\t{String}\tdeviceProperties.function\r\n * @param\t{Object}\tdeviceProperties.states\r\n * @param\t{Object}\t[deviceProperties.attributes={}]\r\n * @param\t{Object}\tdeviceProperties.options\r\n * @param\t{Object}\tsocket\r\n * @return\t{Device}\r\n *\r\n */\r\nexport default class Device extends Function {\r\n\t\r\n\tconstructor(deviceProperties, socket, language = window.sysLang || 'en') {\r\n\t\ttry {\r\n\t\t\tsuper(deviceProperties.function);\r\n\t\t}\r\n\t\tcatch(err) {\r\n\t\t\tthrow new Error('No function given for device ' + deviceProperties.name + '!');\r\n\t\t}\r\n\t\t\r\n\t\t// initialise class data\r\n\t\tthis.id = deviceProperties.id;\r\n\t\tthis.name = deviceProperties.name;\r\n\t\t\r\n\t\tthis.room = deviceProperties.room || null;\r\n\t\t\r\n\t\tthis.states = deviceProperties.states;\r\n\t\tthis.options = deviceProperties.options;\r\n\t\tthis.attributes = deviceProperties.attributes || {};\r\n\t\t\r\n\t\tthis.socket = socket;\r\n\t\t\r\n\t\t// verify data\r\n\t\tif (!this.options || typeof this.options !== 'object' || Object.keys(this.options).length === 0) {\r\n\t\t\tthrow new Error('Device' + (deviceProperties.id || deviceProperties.name ? ' ' + (deviceProperties.name || deviceProperties.id) : '') + ' not defined for jarvis!');\r\n\t\t}\r\n\t\telse if (!this.states || typeof this.states !== 'object' || Object.keys(this.states).length === 0) {\r\n\t\t\tthrow new Error('Insufficent properties provided' + (deviceProperties.id || deviceProperties.name ? ' for device ' + (deviceProperties.name || deviceProperties.id) : '') + ' (no states defined)!');\r\n\t\t}\r\n\t\telse if (!this.id || !this.name || !this.function) {\r\n\t\t\tthrow new Error('Insufficent properties provided' + (deviceProperties.id || deviceProperties.name ? ' for device ' + (deviceProperties.name || deviceProperties.id) : '') + ' (no id, name or function defined)!');\r\n\t\t}\r\n\t\telse if (!this.socket) {\t\r\n\t\t\tthrow new Error('No socket given!');\r\n\t\t}\r\n\t\t\r\n\t\t// hierarchy\r\n\t\tthis.children = deviceProperties.children || [];\r\n\t\tthis.parent = deviceProperties.parent || null;\r\n\t\t\r\n\t\t// do some stuff\r\n\t\tthis._setProperties();\r\n\t\tthis.stateSubscriptions = [];\r\n\t\t\r\n\t\t// listen for errors of the device\r\n\t\tthis.on('error', err => console.error('Device error occured!', err));\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @return\t{Object|String}\r\n\t * @private\r\n\t */\r\n\t_getStateFromKey(stateKey = null, stateType = 'state') {\r\n\t\t\r\n\t\t// already a state object\r\n\t\tif (stateKey && typeof stateKey === 'object') {\r\n\t\t\treturn stateKey;\r\n\t\t}\r\n\t\t\r\n\t\t// get state object\r\n\t\tlet s = this.states[stateKey || this.primaryStateKey];\r\n\t\t\r\n\t\t// state not an object so far\r\n\t\tif (typeof s === 'string') {\r\n\t\t\tthis.states[stateKey || this.primaryStateKey] = { [stateType]: { 'node': s }};\r\n\t\t\ts = this.states[stateKey || this.primaryStateKey];\r\n\t\t}\r\n\t\telse if (typeof s[stateType] === 'string') {\r\n\t\t\tthis.states[stateKey || this.primaryStateKey][stateType] = { 'node': s[stateType] };\r\n\t\t\ts = this.states[stateKey || this.primaryStateKey];\r\n\t\t}\r\n\t\t\r\n\t\t// state not valid\r\n\t\tif (!s || !s[stateType]) {\r\n\t\t\treturn 'Incorrect or non-defined state key for device ' + this.name + '!';\r\n\t\t}\r\n\t\telse if (typeof s[stateType] == 'object' && !s[stateType].node) {\r\n\t\t\treturn 'No ' + stateType + ' specified for device ' + this.name + '!';\r\n\t\t}\r\n\t\t\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_getConfigurationSetting(config, stateKey, attribute, stateVal) {\r\n\t\t\r\n\t\tif (this[config][stateKey]) {\r\n\t\t\t\r\n\t\t\t// 1. if stateKey (e.g. level, power) is available, try to replace an attribute (e.g. icon, unit or for styles state, icon) based on current state (e.g. true, false)\r\n\t\t\tif (typeof this[config][stateKey][attribute] === 'object') {\r\n\t\t\t\treturn super._isValue(this[config][stateKey][attribute][stateVal]) ? this[config][stateKey][attribute][stateVal] : this[config][stateKey][attribute]['default'];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 2. if #1 is a function, apply it\r\n\t\t\telse if (super._isFunction(this[config][stateKey][attribute])) {\r\n\t\t\t\treturn this[config][stateKey][attribute](stateVal);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 3. fallback to stateKey with attribute, if defined but neither an object (thus stateless) nor a function\r\n\t\t\telse if (typeof this[config][stateKey][attribute] === 'string') {\r\n\t\t\t\treturn this[config][stateKey][attribute];\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this[config]['_any']) {\r\n\t\t\t\r\n\t\t\t// 4. fallback to _any if no stateKey (e.g. level, power) is given, but consider attribute to be stateful (e.g. true, false)\r\n\t\t\tif (typeof this[config]['_any'][attribute] === 'object') {\r\n\t\t\t\treturn super._isValue(this[config]['_any'][attribute][stateVal]) ? this[config]['_any'][attribute][stateVal] : this[config]['_any'][attribute]['default'];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 5. if #4 is a function, apply it\r\n\t\t\telse if (super._isFunction(this[config]['_any'][attribute])) {\r\n\t\t\t\treturn this[config]['_any'][attribute](stateVal);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// nothing, return undefined (not null, because this would mean take an empty value)\r\n\t\treturn undefined;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_getUserSetting(stateKey, attribute, stateVal) {\r\n\t\t\r\n\t\tif (this.options[attribute][stateKey]) {\r\n\t\t\t\r\n\t\t\tif (typeof this.options[attribute][stateKey] === 'object') {\r\n\t\t\t\treturn super._isValue(this.options[attribute][stateKey][stateVal]) ? this.options[attribute][stateKey][stateVal] : this.options[attribute][stateKey]['default'];\r\n\t\t\t}\r\n\t\t\telse if (super._isFunction(this.options[attribute][stateKey])) {\r\n\t\t\t\treturn this.options[attribute][stateKey](stateVal);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn this.options[attribute][stateKey];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn undefined;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t *\r\n\t * @return void\r\n\t * @private\r\n\t *\r\n\t */\r\n\t_setProperties() {\r\n\t\t\r\n\t\tlet states = Object.keys(this.states);\r\n\t\t\r\n\t\t// delete ignored states\r\n\t\tif (this.options.ignoredStates) {\r\n\t\t\tthis.options.ignoredStates = Array.isArray(this.options.ignoredStates) ? this.options.ignoredStates : [this.options.ignoredStates];\r\n\t\t\t\r\n\t\t\tthis.options.ignoredStates.forEach(ignoredState => {\r\n\t\t\t\tif (this.states[ignoredState]) {\r\n\t\t\t\t\tdelete this.states[ignoredState];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\t// get hidden states\r\n\t\tthis.options.hiddenStates = [];\r\n\t\tif (this.options.hideStates) {\r\n\t\t\tthis.options.hideStates = Array.isArray(this.options.hideStates) ? this.options.hideStates : [this.options.hideStates];\r\n\t\t\t\r\n\t\t\tthis.options.hideStates.forEach(hideState => {\r\n\t\t\t\tif (this.states[hideState]) {\r\n\t\t\t\t\tthis.options.hiddenStates.push(hideState);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\t// properties\r\n\t\tthis.primaryStateKey = this.options.primary || states[0];\r\n\t\tthis.secondaryStateKey = this.options.secondary || null;\r\n\t\t\r\n\t\t// bring user settings for value, state, unit, icon and styles in structure\r\n\t\t['value', 'state', 'unit', 'icon', 'styles'].forEach(key => {\r\n\t\t\t\r\n\t\t\tlet stateOrAttribute = this.options[key] && Object.keys(this.options[key])[0];\r\n\t\t\tthis.options[key] = !this.options[key] ? {} : super._setObjectStructure(stateOrAttribute && states.indexOf(stateOrAttribute) > -1 ? this.options[key] : { [this.primaryStateKey]: this.options[key] });\r\n\t\t});\r\n\t\t\r\n\t\t// manufacturer\r\n\t\tthis.states[this.primaryStateKey] = this._getStateFromKey(this.primaryStateKey);\r\n\t\tthis.options.manufacturer = (this.primaryStateKey && Adapters[this.states[this.primaryStateKey].state.node.substr(0, this.states[this.primaryStateKey].state.node.indexOf('.'))]) || 'unknown';\r\n\t\t\r\n\t\t// all options\r\n\t\tthis.options.groups = Array.isArray(this.options.group) ? this.options.group : [this.options.group];\r\n\t\tthis.options.sort = this.options.sort || 999;\r\n\t\t\r\n\t\tthis.options.label = (this.options.label && (typeof this.options.label === 'string' && this.options.label.replace(/%name%/g, this.name))) || this.options.label || this.name;\r\n\t\t//this.options.subtitle = this.options.subtitle;\r\n\t\tthis.options.divider = this.options.divider || false;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t *\r\n\t * @return\t{Object}\r\n\t * @private\r\n\t */\r\n\t_updateDeviceState(stateKey, state) {\r\n\t\t\r\n\t\t// add time changed\r\n\t\tstate.timeChanged = formatDistanceToNow(new Date(state.lc-5*1000), { locale: de, includeSeconds: true, addSuffix: true })\r\n\t\t\r\n\t\t// add unit\r\n\t\tstate.unit = '';\r\n\t\t\r\n\t\t// assign value\r\n\t\tstate.value = state.val;\r\n\t\t\r\n\t\t// mapping of value to state values\r\n\t\t[{ 'value': 'value' }, { 'state': 'value' }, { 'unit': 'unit' }].forEach(pair => {\r\n\t\t\tlet attribute = Object.keys(pair).toString();\r\n\t\t\tlet option = Object.values(pair).toString();\r\n\t\t\tlet settings = {};\r\n\t\t\t\r\n\t\t\t// get user setting\r\n\t\t\tsettings['options'] = this._getUserSetting(stateKey, attribute, state.value);\r\n\t\t\t\r\n\t\t\t// get function setting or fallback to defaults\r\n\t\t\t['configurations', 'defaults'].forEach(config => {\r\n\t\t\t\tsettings[config] = this._getConfigurationSetting(config, stateKey, attribute, state.value);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tstate[option] = super._getValueFromSettings(settings, state[option]);\r\n\t\t\t\r\n\t\t});\r\n\t\t\r\n\t\tstate.value = i18n.t(state.value);\r\n\t\treturn state;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tget(property) {\r\n\t\treturn this[property] || null;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param\t{String}\t[stateKey=this.primaryStateKey]\r\n\t * @return\t{React.Component}\r\n\t */\r\n\tgetAction(stateKey = null, forceDefault = false) {\r\n\t\tstateKey = stateKey || this.primaryStateKey;\r\n\t\t\r\n\t\tconst state = this.states[stateKey].state.value;\r\n\t\tconst stateVal = state.val;\r\n\t\t\r\n\t\tconst Action = (!forceDefault && this.actions[stateKey]) || this.actions.Action;\r\n\t\treturn <Action key={'action-' + this.id + '-' + stateKey} device={this} state={state} stateKey={stateKey} stateVal={stateVal} styles={this.getStyle('state', stateKey, stateVal)} />\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param\t{String}\t[stateKey=this.primaryStateKey]\r\n\t * @return\t{React.Component}\r\n\t */\r\n\tgetComponent(stateKey) {\r\n\t\tstateKey = stateKey || this.primaryStateKey;\r\n\t\tconst stateVal = this.states[stateKey].state.value.val;\r\n\t\t\r\n\t\tconst Component = this.components[stateKey];\r\n\t\treturn (Component && <Component title={i18n.t(this.function + '#' + stateKey)} device={this} stateKey={stateKey} stateVal={stateVal} />) || i18n.t(this.function + '#' + stateKey);\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param\t{String}\t[stateKey=this.primaryStateKey]\r\n\t * @param\t{String}\t[stateProperty=null]\r\n\t * @return\t{String}\r\n\t */\r\n\tgetDeviceState(stateKey = null, stateProperty = null) {\r\n\t\tconst s = this.states[stateKey || this.primaryStateKey];\r\n\t\t\r\n\t\tlet deviceState = null;\r\n\t\t\r\n\t\tif (s && s.state && stateProperty !== null && s.state.value !== undefined && s.state.value[stateProperty] !== undefined) {\r\n\t\t\tdeviceState = s.state.value[stateProperty];\r\n\t\t}\r\n\t\telse if (s && s.state && stateProperty === null && s.state.value !== undefined) {\r\n\t\t\tdeviceState = s.state.value;\r\n\t\t}\r\n\t\t\r\n\t\treturn deviceState;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get an icon based on the current device state (or falls back to a default).\r\n\t *\r\n\t * @param\t{String}\t[stateKey=this.primaryStateKey]\r\n\t * @param\t{String}\t[stateVal=default]\r\n\t * @param\t{String}\t[defaultIcon=null]\r\n\t * @return\t{String}\r\n\t */\r\n\tgetIcon(stateKey, stateVal = '', defaultIcon = '?') {\r\n\t\t\r\n\t\tstateKey = stateKey || this.primaryStateKey;\r\n\t\t\r\n\t\tlet settings = {};\r\n\t\t\r\n\t\t// get user setting\r\n\t\tsettings['options'] = this._getUserSetting(stateKey, 'icon', stateVal);\r\n\t\t\r\n\t\t// get function setting or fallback to defaults\r\n\t\t['configurations', 'defaults'].forEach(config => {\r\n\t\t\tsettings[config] = this._getConfigurationSetting(config, stateKey, 'icon', stateVal);\r\n\t\t});\r\n\t\t\r\n\t\treturn super._getValueFromSettings(settings, defaultIcon);\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tgetOption(option, stateVal = 'default') {\r\n\t\treturn (this.options[option] && (this.options[option][stateVal] || this.options[option]['default'])) || this.options[option] || null;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tgetStyle(attribute, stateKey, stateVal = 'default') {\r\n\t\tlet settings = {};\r\n\t\t\r\n\t\t// get user setting\r\n\t\tsettings['options'] = this._getUserSetting(stateKey, 'styles', attribute, stateVal);\r\n\t\t\r\n\t\t// get function setting or fallback to defaults\r\n\t\t['styles', 'defaultStyles'].forEach(config => {\r\n\t\t\tsettings[config] = this._getConfigurationSetting(config, stateKey, attribute, stateVal);\r\n\t\t});\r\n\t\t\r\n\t\treturn super._getValueFromSettings(settings, {});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Requests all state values from the backend.\r\n\t *\r\n\t * @param\t{Boolean}\t[subscribe=false]\r\n\t * @return\t{Array<Promises>}\r\n\t *\r\n\t */\r\n\trequestDeviceStates(subscribe = false) {\r\n\t\t\r\n\t\tlet responses = [];\r\n\t\tfor (let stateKey in this.states) {\r\n\t\t\tresponses.push(this.requestDeviceState(stateKey, subscribe));\r\n\t\t}\r\n\t\t\r\n\t\treturn responses;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Requests a state value from the backend.\r\n\t *\r\n\t * @param\t{String}\t[stateKey=this.primaryStateKey]\r\n\t * @param\t{Boolean}\t[subscribe=false]\r\n\t * @return\t{Promise}\r\n\t *\r\n\t */\r\n\trequestDeviceState(stateKey = null, subscribe = false) {\r\n\t\t\r\n\t\tstateKey = stateKey || this.primaryStateKey;\r\n\t\tlet s = this._getStateFromKey(stateKey);\r\n\t\tif (typeof s == 'string') {\r\n\t\t\treturn Promise.reject({ 'success': false, 'stateKey': stateKey, 'error': s });\r\n\t\t}\r\n\t\t\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\r\n\t\t\t// send cached value if present and subscrbe (means always updated)\r\n\t\t\tif (s.state.value !== undefined && this.stateSubscriptions.indexOf(stateKey) > -1) {\r\n\t\t\t\t\r\n\t\t\t\t// publish state\r\n\t\t\t\tthis.emit('stateChange', stateKey, s.state.value);\r\n\t\t\t\t\r\n\t\t\t\t// resolve\r\n\t\t\t\tresolve({ 'success': true, 'stateKey': stateKey, 'cached': true });\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// request from backend\r\n\t\t\telse {\r\n\t\t\t\tthis.socket.getState(s.state.node)\r\n\t\t\t\t\t.then(state => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// state does not exist\r\n\t\t\t\t\t\tif (state === null) {\r\n\t\t\t\t\t\t\treject({ 'success': false, 'stateKey': stateKey, 'error': 'State ' + s.state.node + ' not found!' });\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// set result\r\n\t\t\t\t\t\ts.state.value = this._updateDeviceState(stateKey, state);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// publish state change\r\n\t\t\t\t\t\tthis.emit('stateChange', stateKey, s.state.value);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// subscribe to state\r\n\t\t\t\t\t\tif (subscribe) {\r\n\t\t\t\t\t\t\tthis.subscribeDeviceState(stateKey).catch(err => reject(err));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// resolve\r\n\t\t\t\t\t\tresolve({ 'success': true, 'stateKey': stateKey, 'cached': false });\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => reject({ 'success': false, 'stateKey': stateKey, 'error': err }));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Requests a state value from the backend.\r\n\t *\r\n\t * @param\t{String}\t[stateKey=this.primaryStateKey]\r\n\t * @param\t{Boolean}\t[subscribe=false]\r\n\t * @param\t{Object}\t[options={}]\r\n\t * @return\t{Promise}\r\n\t * @see https://github.com/ioBroker/ioBroker.history#access-values-from-javascript-adapter\r\n\t *\r\n\t */\r\n\trequestDeviceStateHistory(stateKey = null, subscribe = false, options = {}) {\r\n\t\t\r\n\t\tstateKey = stateKey || this.primaryStateKey;\r\n\t\tlet s = this._getStateFromKey(stateKey);\r\n\t\tif (typeof s == 'string') {\r\n\t\t\treturn Promise.reject({ 'success': false, 'stateKey': stateKey, 'error': s });\r\n\t\t}\r\n\t\t\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\ts.state.historyCache = s.state.historyCache || {};\r\n\t\t\t\r\n\t\t\t// send cached value if present and subscrbe (means always updated)\r\n\t\t\tif (options.start && options.end && options.step && s.state.historyCache[options.start + '#' + options.end + '#' + options.step] !== undefined) {\r\n\t\t\t\t\r\n\t\t\t\t// publish state\r\n\t\t\t\tthis.emit('historyChange', stateKey, s.state.historyCache[options.start + '#' + options.end + '#' + options.step], s.state);\r\n\t\t\t\t\r\n\t\t\t\t// resolve\r\n\t\t\t\tresolve({ 'success': true, 'stateKey': stateKey, 'cached': true });\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// request from backend\r\n\t\t\telse {\r\n\t\t\t\tthis.socket.getStateHistory(s.state.node, options)\r\n\t\t\t\t\t.then(history => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// state does not exist\r\n\t\t\t\t\t\tif (history === null) {\r\n\t\t\t\t\t\t\treject({ 'success': false, 'stateKey': stateKey, 'error': 'State ' + s.state.node + ' not found!' });\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// cache result\r\n\t\t\t\t\t\tif (options.start && options.end && options.step) {\r\n\t\t\t\t\t\t\ts.state.historyCache[options.start + '#' + options.end + '#' + options.step] = history;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// set result\r\n\t\t\t\t\t\ts.state.history = history;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// publish state change\r\n\t\t\t\t\t\tthis.emit('historyChange', stateKey, s.state.history, s.state);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// subscribe to state\r\n\t\t\t\t\t\tif (subscribe) {\r\n\t\t\t\t\t\t\tthis.subscribeDeviceState(stateKey).catch(err => reject(err));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// resolve\r\n\t\t\t\t\t\tresolve({ 'success': true, 'stateKey': stateKey, 'cached': false });\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => reject({ 'success': false, 'stateKey': stateKey, 'error': err }));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tsetAction(action) {\r\n\t\tthis.options.action = action;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tsetComponent(component) {\r\n\t\tthis.options.label = component;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param\t{String}\tvalue\r\n\t * @param\t{String}\t[stateKey=this.primaryStateKey]\r\n\t * @return\tvoid\r\n\t */\r\n\tsetDeviceState(stateKey = null, value) {\r\n\t\t\r\n\t\tstateKey = stateKey || this.primaryStateKey;\r\n\t\tlet s = this._getStateFromKey(stateKey, 'action');\r\n\t\tif (typeof s == 'string') {\r\n\t\t\treturn Promise.reject({ 'success': false, 'stateKey': stateKey, 'error': s });\r\n\t\t}\r\n\t\t\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.socket.setState(s.action.node, value)\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\r\n\t\t\t\t\t// get state value if not subscribed\r\n\t\t\t\t\tif (this.stateSubscriptions.indexOf(stateKey) === -1) {\r\n\t\t\t\t\t\tthis.requestDeviceState(stateKey);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// resolve\r\n\t\t\t\t\tresolve({ 'success': true, 'stateKey': stateKey });\r\n\t\t\t\t})\r\n\t\t\t\t.catch(err => reject({ 'success': false, 'stateKey': stateKey, 'error': err }));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param\t{String}\t[stateKey=this.primaryStateKey]\r\n\t * @return\tvoid\r\n\t */\r\n\tsubscribeDeviceState(stateKey = null) {\r\n\t\t\r\n\t\tstateKey = stateKey || this.primaryStateKey;\r\n\t\tlet s = this._getStateFromKey(stateKey);\r\n\t\tif (typeof s == 'string') {\r\n\t\t\treturn Promise.reject({ 'success': false, 'stateKey': stateKey, 'error': s });\r\n\t\t}\r\n\t\t\r\n\t\t// add subscription\t\r\n\t\tthis.stateSubscriptions.push(stateKey);\r\n\t\t\r\n\t\t// subscribe\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tthis.socket.subscribeState(s.state.node, (id, state, params) => {\r\n\t\t\t\t\r\n\t\t\t\tif (state && state.val !== this.getDeviceState(stateKey, 'val')) {\r\n\t\t\t\t\t\r\n\t\t\t\t\t// format value\r\n\t\t\t\t\ts.state.value = this._updateDeviceState(stateKey, state);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// publish state change\r\n\t\t\t\t\tthis.emit('stateChange', stateKey, s.state.value);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// publish to children as well\r\n\t\t\t\t\tthis.children.forEach(child => child.emit('stateChange', stateKey, s.state.value));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tresolve({ 'success': true, 'stateKey': stateKey });\r\n\t\t});\r\n\t}\r\n}\r\n","import React from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport AppBar from '@material-ui/core/AppBar'\r\nimport Toolbar from '@material-ui/core/Toolbar'\r\nimport Typography from '@material-ui/core/Typography'\r\n//import IconButton from '@material-ui/core/IconButton'\r\n//import Badge from '@material-ui/core/Badge'\r\n//import NotificationsIcon from '@material-ui/icons/Notifications'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\tappBar: {\r\n\t\tflexGrow: 1,\r\n\t\tboxShadow: 'none',\r\n\t\ttransform: 'none',\r\n\t},\r\n\ttoolbar: {\r\n\t\tbackgroundColor: theme.palette.primary.main\r\n\t},\r\n\tmenuButton: {\r\n\t\tmarginRight: theme.spacing(2),\r\n\t},\r\n\ttitle: {\r\n\t\tflexGrow: 1,\r\n\t},\r\n\ticon: {\r\n\t\t...theme.components.icon,\r\n\t\tcolor: '#fff',\r\n\t\tpaddingRight: '6px',\r\n\t\twidth: '1em',\r\n\t\theight: '1em',\r\n\t\tdisplay: 'inline-block',\r\n\t\tfontSize: '1.5rem',\r\n\t\ttransition: 'fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms',\r\n\t\tflexShrink: 0,\r\n\t\tuserSelect: 'none'\r\n\t}\r\n}));\r\n\r\n\r\nexport default function TopBar(props) {\r\n\tconst classes = useStyles();\r\n\t\r\n\tconst { children, title } = props;\r\n\tconst [ icon, label ] = title.indexOf('|') > -1 ? title.split('|') : [ null, title ];\r\n\treturn (\r\n\r\n<AppBar id=\"appBar\" position=\"static\" className={classes.appBar}>\r\n\r\n\t<Toolbar className={classes.toolbar}>\r\n\t\t<Typography variant=\"h6\" className={classes.title}>\r\n\t\t\t{icon && <span className={clsx(classes.icon, 'mdi mdi-' + icon)}></span>}\r\n\t\t\t{label !== 'null' && label}\r\n\t\t</Typography>\r\n\t\t{/*\r\n\t\t<IconButton color=\"inherit\">\r\n\t\t\t<Badge badgeContent={17} color=\"secondary\">\r\n\t\t\t\t<NotificationsIcon />\r\n\t\t\t</Badge>\r\n\t\t</IconButton>\r\n\t\t*/}\r\n\t</Toolbar>\r\n\t\r\n\t{children}\r\n</AppBar>\r\n\r\n\t);\r\n}\r\n","/*\r\n * by QoP <https://stackoverflow.com/users/4484822/qop>\r\n * @see https://stackoverflow.com/questions/36862334/get-viewport-window-height-in-reactjs\r\n */\r\nimport { useState, useEffect } from 'react';\r\n\r\nfunction getWindowDimensions() {\r\n  const { innerWidth: width, innerHeight: height } = window;\r\n  return {\r\n    width,\r\n    height\r\n  };\r\n}\r\n\r\nexport default function useWindowDimensions() {\r\n  const [windowDimensions, setWindowDimensions] = useState(getWindowDimensions());\r\n\r\n  useEffect(() => {\r\n    function handleResize() {\r\n      setWindowDimensions(getWindowDimensions());\r\n    }\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  return windowDimensions;\r\n}\r\n","import React, { useState, useEffect, useRef, useCallback } from 'react'\r\nimport clsx from 'clsx'\r\n\r\nimport useWindowDimensions from '../helpers/useWindowDimensions'\r\n\r\nimport Tabs from '@material-ui/core/Tabs'\r\nimport Tab from '@material-ui/core/Tab'\r\nimport Box from '@material-ui/core/Box'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\ticon: {\r\n\t\t...theme.components.icon,\r\n\t\tcolor: '#fff',\r\n\t\tpaddingBottom: '6px',\r\n\t\twidth: '1em',\r\n\t\theight: '1em',\r\n\t\tdisplay: 'inline-block',\r\n\t\tfontSize: '1.5rem',\r\n\t\ttransition: 'fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms',\r\n\t\tflexShrink: 0,\r\n\t\tuserSelect: 'none'\r\n\t},\r\n\ttabs: {\r\n\t\tbackgroundColor: theme.palette.primary.main,\r\n\t\tpaddingLeft: theme.spacing(),\r\n\t\tcolor: '#fff',\r\n\t\twidth: 'calc(100% - ' + theme.spacing() + 'px)',\r\n\t\tzIndex: 101,\r\n\t\tborderBottom: '5px solid #eee'\r\n\t},\r\n\tfixed: {\r\n\t\tposition: 'fixed',\r\n\t\ttop: 0\r\n\t},\r\n\tindicator: {\r\n\t\tbackgroundColor: '#fff',\r\n\t},\r\n\tfullscreen: {\r\n\t\tmarginLeft: -theme.spacing(),\r\n\t\tmarginTop: '-5px',\r\n\t},\r\n\tgrid: {\r\n\t\tpaddingBottom: '30px'\r\n\t}\r\n}));\r\n\r\n\r\nexport default function TabBar(props) {\r\n\tlet { tabs, selectTab } = props;\r\n\tconst classes = useStyles();\r\n\tlet tabBarProps = useRef({});\r\n\t\r\n\t// tab\r\n\tconst [tab, setTab] = useState(0);\r\n\tconst handleChange = (event, selectedTab) => {\r\n\t\tselectTab(selectedTab, tabs[selectedTab]);\r\n\t\tsetTab(selectedTab);\r\n\t}\r\n\t\r\n\t// scroll\r\n\tconst [fixed, setFixed] = useState(false);\r\n\tconst handleScroll = useCallback(() => {\r\n\t\tconst threshold = (tabBarProps.current.top + tabBarProps.current.height - 53);\r\n\t\tconst fixed = window.scrollY >= threshold;\r\n\t\t\r\n\t\tsetFixed(prevFixed => {\r\n\t\t\tif (prevFixed !== fixed) {\r\n\t\t\t\tdocument.getElementById('root').style.paddingTop = fixed ? (threshold-5-8) + 'px' : 0;\r\n\t\t\t\treturn fixed;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn prevFixed;\r\n\t\t});\r\n\t\t\r\n\t}, [tabBarProps]);\r\n\r\n\tuseEffect(() => {\r\n\t\ttabBarProps.current = {\r\n\t\t\ttop: document.getElementById('tabBar').offsetTop,\r\n\t\t\theight: document.getElementById('tabBar').offsetHeight\r\n\t\t}\r\n\t\t\r\n\t\twindow.addEventListener('scroll', handleScroll);\r\n\t\treturn () => window.removeEventListener('keydown', handleScroll, 0);\r\n\t\t\r\n\t}, [handleScroll]);\r\n\t\r\n\t// render tabs\r\n\tconst renderedTabs = tabs.map((tab, i) => {\r\n\t\tconst [ icon, label ] = tab.indexOf('|') > -1 ? tab.split('|') : [ null, tab ];\r\n\t\treturn <Tab key={'tab' + i} icon={<span className={clsx(classes.icon, 'mdi mdi-' + icon)}></span>} label={!fixed && label !== 'null' ? label : null} />\r\n\t});\r\n\t\r\n\treturn (\r\n\r\n<Tabs\r\n\tid=\"tabBar\"\r\n\tvalue={tab}\r\n\tonChange={handleChange}\r\n\tvariant=\"scrollable\"\r\n\tclasses={{\r\n\t\troot: clsx(classes.tabs, fixed && classes.fixed),\r\n\t\tindicator: classes.indicator\r\n\t}}>\r\n\t\r\n\t{renderedTabs}\r\n</Tabs>\r\n\r\n\t);\r\n}\r\n\r\n\r\nexport function TabPanel(props) {\r\n\tconst { children, selectedTab, renderedTab, fullscreen } = props;\r\n\tconst classes = useStyles();\r\n\t\r\n\t\r\n\t// get map height based on viewport\r\n\tconst { height } = useWindowDimensions();\r\n\tconst [mapHeight, setMapHeight] = useState(height);\r\n\tlet topBarHeight = useRef({});\r\n\t\r\n\tuseEffect(() => {\r\n\t\ttopBarHeight.current = document.getElementById('appBar').offsetHeight;\r\n\t\tsetMapHeight(height-topBarHeight.current+5);\r\n\t\t\r\n\t}, [height]);\r\n\t\r\n\t/*\r\n\t * Some components need to be visible upon loading, so proper initialise.\r\n\t * Due to the 'hidden' attribute though, they might be hidden.\r\n\t * This is a workaround to initially show everything for a short period of time and then hide according to tab settings.\r\n\t *\r\n\t */\r\n\tconst [hidden, setHidden] = useState(null);\r\n\tuseEffect(() => {\r\n\t\tsetTimeout(() => setHidden(selectedTab !== renderedTab), 10);\r\n\t\t\r\n\t}, [selectedTab, renderedTab]);\r\n\t\r\n\treturn (\r\n\r\n<Box\r\n\trole=\"tabpanel\"\r\n\thidden={hidden}\r\n\tid={'tabpanel-' + renderedTab}\r\n\tclassName={clsx(fullscreen ? classes.fullscreen : classes.grid)}\r\n\tstyle={{ height: mapHeight + 'px' }}\r\n\t>\r\n\t\r\n\t{children}\r\n</Box>\r\n\r\n\t);\r\n}\r\n","\r\nexport const ModuleSettings = {\r\n\tAdapterStatus: require('./AdapterStatus').Settings || {},\r\n\tChart: require('./Chart').Settings || {},\r\n\tDateTime: require('./DateTime').Settings || {},\r\n\tMap: require('./Map').Settings || {},\r\n\tMultimedia: require('./Multimedia').Settings || {},\r\n\tStateList: require('./StateList').Settings || {},\r\n\tStateListHorizontal: require('./StateListHorizontal').Settings || {},\r\n\tWeather: require('./Weather').Settings || {}\r\n}\r\n\r\nexport default {\r\n\tAdapterStatus: require('./AdapterStatus').default,\r\n\tChart: require('./Chart').default,\r\n\tDateTime: require('./DateTime').default,\r\n\tMap: require('./Map').default,\r\n\tMultimedia: require('./Multimedia').default,\r\n\tStateList: require('./StateList').default,\r\n\tStateListHorizontal: require('./StateListHorizontal').default,\r\n\tWeather: require('./Weather').default\r\n}","import React from 'react';\r\nimport Connection from '../Connection';\r\nimport Device from '../Device';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport MuiDialogTitle from '@material-ui/core/DialogTitle';\r\nimport MuiDialogContent from '@material-ui/core/DialogContent';\r\nimport MuiDialogActions from '@material-ui/core/DialogActions';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport Modules from '../modules';\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { withStyles } from '@material-ui/core/styles';\r\nconst styles = theme => ({\r\n\troot: {\r\n\t\tmargin: 0,\r\n\t\tpadding: theme.spacing(2),\r\n\t},\r\n\tcloseButton: {\r\n\t\tposition: 'absolute',\r\n\t\tright: theme.spacing(1),\r\n\t\ttop: theme.spacing(1),\r\n\t\tcolor: theme.palette.grey[500],\r\n\t},\r\n});\r\n\r\n\r\nconst DialogTitle = withStyles(styles)(props => {\r\n\tconst { children, classes, onClose, ...other } = props;\r\n\treturn (\r\n\r\n<MuiDialogTitle disableTypography className={classes.root} {...other}>\r\n\t<Typography variant=\"h6\">{children}</Typography>\r\n\t{onClose ? (\r\n\t<IconButton aria-label=\"close\" className={classes.closeButton} onClick={onClose}>\r\n\t\t<CloseIcon />\r\n\t</IconButton>\r\n\t) : null}\r\n</MuiDialogTitle>\r\n\r\n\t);\r\n});\r\n\r\nconst DialogContent = withStyles(theme => ({\r\n\troot: {\r\n\t\tpadding: theme.spacing(2),\r\n\t\t[theme.breakpoints.down('md')]: {\r\n\t\t\tpaddingLeft: theme.spacing(1)\r\n\t\t}\r\n\t},\r\n}))(MuiDialogContent);\r\n\r\nconst DialogActions = withStyles(theme => ({\r\n\troot: {\r\n\t\tmargin: 0,\r\n\t\tpadding: theme.spacing(1),\r\n\t},\r\n}))(MuiDialogActions);\r\n\r\n\r\nexport default class Popup extends React.Component {\r\n\t\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t\r\n\t\tthis.state = {\r\n\t\t\tchildren: []\r\n\t\t};\r\n\t}\r\n\t\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\t\r\n\t\tlet device = this.props.contents && this.props.contents.device;\r\n\t\tif (device.id && this.props.contents.ts !== prevProps.contents.ts) {\r\n\t\t\t\r\n\t\t\t// get from cache\r\n\t\t\tif (device.children.length) {\r\n\t\t\t\tconsole.info('Got ' + Object.keys(device.children).length + ' states for device ' + device.name + ' from cache.');\r\n\t\t\t\tthis.setState({ 'children': device.children }, () => this.forceUpdate());\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// retrieve new\r\n\t\t\telse {\r\n\t\t\t\t// loop through states and request status\r\n\t\t\t\tlet responses = [];\r\n\t\t\t\tlet children = [];\r\n\t\t\t\t\r\n\t\t\t\tfor (let stateKey in device.states) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (device.states[stateKey].state === undefined || device.options.hiddenStates.indexOf(stateKey) > -1) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet child = new Device({\r\n\t\t\t\t\t\t\t'parent': device,\r\n\t\t\t\t\t\t\t'id': device.id + '#' + stateKey,\r\n\t\t\t\t\t\t\t'name': device.name,\r\n\t\t\t\t\t\t\t'function': device.function,\r\n\t\t\t\t\t\t\t'states': { [stateKey]: device.states[stateKey] },\r\n\t\t\t\t\t\t\t'options': {\r\n\t\t\t\t\t\t\t\t'primary': stateKey,\r\n\t\t\t\t\t\t\t\t'divider': children.length !== 0,\r\n\t\t\t\t\t\t\t\t'subgroup': null,\r\n\t\t\t\t\t\t\t\t'subtitle': null\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tConnection.getConnection,\r\n\t\t\t\t\t\twindow.language\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// add child to parent\r\n\t\t\t\t\tdevice.children.push(child);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// retrieve state\r\n\t\t\t\t\tresponses.push(child.requestDeviceState(null, true));\r\n\t\t\t\t\tchildren.push(child);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tPromise.allSettled(responses).then(() => {\r\n\t\t\t\t\tconsole.info('Retrieved ' + Object.keys(children).length + ' states for device ' + device.name + '.', responses);\r\n\t\t\t\t\tthis.setState({ 'children': children }, () => this.forceUpdate());\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (!device.id && this.props.contents.ts !== prevProps.contents.ts) {\r\n\t\t\tthis.setState({ 'children': [] }, () => this.forceUpdate());\r\n\t\t}\r\n\t}\r\n\t\r\n\tshouldComponentUpdate(nextProps, nextState) {\r\n\t\treturn !this.props.contents || this.props.contents.ts !== nextProps.contents.ts;\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tconst { open, closeDialog, contents } = this.props;\r\n\t\tconst { device } = contents;\r\n\t\t\r\n\t\treturn (\r\n\r\n<Dialog onClose={closeDialog} open={open || false} maxWidth={'md'} fullWidth={true}>\r\n\t<DialogTitle onClose={closeDialog}>\r\n\t\t{device.name}\r\n\t</DialogTitle>\r\n\t<DialogContent dividers style={{ padding: 0 }}>\r\n\t\t\r\n\t\t<Modules.StateList openDialog={null} devices={this.state.children} component={true} action={true} />\t\r\n\t\t\r\n\t</DialogContent>\r\n\t<DialogActions>\r\n\t\t<Button autoFocus onClick={closeDialog} color=\"primary\">\r\n\t\t\tClose\r\n\t\t</Button>\r\n\t</DialogActions>\r\n</Dialog>\r\n\r\n\t\t);\r\n\t};\r\n}\r\n","import React from 'react'\r\n\r\nimport Card from '@material-ui/core/Card'\r\nimport CardHeader from '@material-ui/core/CardHeader'\r\nimport CardContent from '@material-ui/core/CardContent'\r\nimport Avatar from '@material-ui/core/Avatar'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nconst useStyles = makeStyles(theme => ({\r\n\tcard: {\r\n\t\tmargin: theme.spacing(1, 1, 0, 0),\r\n\t\t[theme.breakpoints.down('md')]: {\r\n\t\t\tmargin: theme.spacing(0.4, 0.4, 0, 0)\r\n\t\t}\r\n\t},\r\n\tcardHeaderNoContents: {\r\n\t\tpadding: theme.spacing(),\r\n\t},\r\n\tcardAvatar: props => ({\r\n\t\tbackgroundColor: theme.palette.primary.main,\r\n\t\tcolor: '#fff',\r\n\t\tfontSize: '24px',\r\n\t\t...props\r\n\t}),\r\n\tcardContent: {\r\n\t\tpadding: theme.spacing(0, 2),\r\n\t\t[theme.breakpoints.down('md')]: {\r\n\t\t\tpadding: theme.spacing(0)\r\n\t\t}\r\n\t}\r\n}));\r\n\r\n\r\nexport default function Widget(props) {\r\n\tconst { title, icon, iconStyle } = props;\r\n\tconst classes = useStyles(iconStyle);\r\n\t\r\n\treturn (\r\n\r\n<Card className={classes.card}>\r\n\t<CardHeader\r\n\t\tavatar={icon !== null &&\r\n\t\t\t<Avatar variant=\"rounded\" classes={{ root: classes.cardAvatar }}>\r\n\t\t\t\t{React.createElement('span', { 'className': 'mdi mdi-' + (icon || 'home') })}\r\n\t\t\t</Avatar>\r\n\t\t}\r\n\t\ttitle={title &&\r\n\t\t\t<Typography variant=\"h5\" component=\"h2\">\r\n\t\t\t\t{title}\r\n\t\t\t</Typography>\r\n\t\t}\r\n\t/>\r\n\t<CardContent className={classes.cardContent}>\r\n\t\t{props.children}\r\n\t</CardContent>\r\n</Card>\r\n\r\n\t);\r\n}\r\n","import { createMuiTheme } from '@material-ui/core/styles'\r\nimport { pink } from '@material-ui/core/colors'\r\nimport blue from '@material-ui/core/colors/blue'\r\n\r\nconst primary = blue[700]\r\nconst secondary = pink\r\n\r\nconst theme = createMuiTheme({\r\n\tpalette: {\r\n\t\tprimary: {\r\n\t\t\tmain: primary \r\n\t\t},\r\n\t\tsecondary: secondary,\r\n\t},\r\n\tcomponents: {\r\n\t\ticon: {\r\n\t\t\tfontSize: '24px',\r\n\t\t\tcolor: primary\r\n\t\t},\r\n\t\t'finger': {\r\n\t\t\tcursor: 'pointer'\r\n\t\t}\r\n\t}\r\n});\r\n\r\n//console.debug(theme);\r\nexport default theme;","import React from 'react'\r\n\r\n//import Drawer from '@material-ui/core/Drawer'\r\n\r\nimport TopBar from './components/TopBar'\r\nimport TabBar, { TabPanel } from './components/TabBar'\r\nimport GridContainer from './components/GridContainer'\r\nimport Popup from './components/Popup'\r\nimport Widget from './components/Widget'\r\nimport Modules, { ModuleSettings } from './modules'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { ThemeProvider } from '@material-ui/core/styles';\r\nimport theme from './theme';\r\n\r\n\r\n/*\r\n *\r\n */\r\nconst getGroup = (groupId, group, props = {}) => {\r\n\t\r\n\t// group empty\r\n\tif (!group && ModuleSettings[group.settings.component.module].noDevicesAllowed !== true) {\r\n\t\tconsole.error('Group ' + groupId + ' defined in columns but not assigned to any devices!');\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\t// get module for component\r\n\tgroup.settings.component = typeof group.settings.component === 'string' ? { 'module': group.settings.component } : (group.settings.component || {});\r\n\tconst Tag = Modules[group.settings.component.module || 'StateList'];\r\n\t\r\n\t// get tag\r\n\tif (Tag === undefined) {\r\n\t\tconsole.error('Undefined component \"' + group.settings.component.module + '\" used!');\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\treturn <Tag key={'Tag' + groupId} devices={group.devices} openDialog={props.action ? props.action : null} settings={{ ...group.settings, ...props }} />\r\n}\r\n\r\n\r\n/*\r\n *\r\n */\r\nconst getGridContents = (contents, groups, props = {}) => {\r\n\t\r\n\tlet gridContents = {};\r\n\tconst columns = Object.keys(contents).length;\r\n\t\r\n\tfor (let column = 1; column <= columns; column++) {\r\n\t\t\r\n\t\tlet columnContents = contents[column];\r\n\t\tgridContents[column] = gridContents[column] || [];\r\n\t\t\r\n\t\t// no contents, thus add placeholder\r\n\t\tif (!columnContents || !Object.keys(columnContents).length) {\r\n\t\t\tgridContents[column].push(null);\r\n\t\t}\r\n\t\t\r\n\t\t// add contents\r\n\t\telse {\r\n\t\t\tfor (let groupId in columnContents) {\r\n\t\t\t\t\r\n\t\t\t\tlet group = groups[groupId] || {};\r\n\t\t\t\tgroup.settings = columnContents[groupId] || {};\r\n\t\t\t\tgroup.settings.component = typeof group.settings.component === 'string' ? { 'module': group.settings.component } : (group.settings.component || {});\r\n\t\t\t\t\r\n\t\t\t\tlet content = getGroup(groupId, group, props);\r\n\t\t\t\tif (content) {\r\n\t\t\t\t\tgridContents[column].push(\r\n\t\t\t\t\t\t<Widget key={'Box-' + groupId} title={group.settings.title === null ? null : (group.settings.title || group.name || (ModuleSettings[group.settings.component.module] && ModuleSettings[group.settings.component.module].title))} icon={group.settings.icon === null ? null : (group.settings.icon || (ModuleSettings[group.settings.component.module] && ModuleSettings[group.settings.component.module].icon))} iconStyle={group.settings.iconStyle}>\r\n\t\t\t\t\t\t\t{content}\r\n\t\t\t\t\t\t</Widget>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn gridContents;\r\n}\r\n\r\n\r\nexport default class Jarvis extends React.Component {\r\n\t\r\n    constructor(props) {\r\n\t\tsuper(props);\r\n\t\t\r\n\t\tthis.state = {\r\n\t\t\tselectedTab: 0,\r\n\t\t\ttabTitle: '',\r\n\t\t\t\r\n\t\t\tnotificationDrawer: false,\r\n\t\t\tdialog: false,\r\n\t\t\tdialogContents: {\r\n\t\t\t\t'ts': 0,\r\n\t\t\t\t'device': {}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// bind methods\r\n\t\tthis.closeDialog = this.closeDialog.bind(this);\r\n\t\tthis.openDialog = this.openDialog.bind(this);\r\n\t\tthis.selectTab = this.selectTab.bind(this);\r\n\t\t//this.toggleDrawer = this.toggleDrawer.bind(this);\r\n\t\t\r\n\t\t// initialise\r\n\t\tthis.gridContents = {};\r\n\t\tthis.layout = this.props.settings.layout;\r\n\t\tthis.tabs = Object.keys(this.layout);\r\n\t\tthis.tabsEnabled = this.tabs[0] !== 1;\r\n\t\tthis.state.tabTitle = this.tabs[this.state.selectedTab];\r\n\t\t\r\n\t\t// no tabs defined, so layout wrap into default tab\r\n\t\tif (!this.tabsEnabled) {\r\n\t\t\tthis.layout = { 'Home': this.layout };\r\n\t\t\tthis.tabs.push('1');\r\n\t\t}\r\n\t\t\r\n\t\t// widget props\r\n\t\tthis.widgetProps = {}\r\n\t}\r\n\t\r\n\tgetTabPanels() {\r\n\t\t\r\n\t\tlet tab = 0;\r\n\t\tlet tabPanels = [];\r\n\t\tfor (let tabLabel in this.layout) {\r\n\t\t\tconst contents = this.layout[tabLabel];\r\n\t\t\t\r\n\t\t\t// fullscreen in component\r\n\t\t\tlet groupId = Object.keys(contents)[0];\r\n\t\t\tlet fullscreen = Number.isNaN(parseInt(groupId));\r\n\t\t\t\r\n\t\t\tif (!this.gridContents[tabLabel] && fullscreen) {\r\n\t\t\t\tthis.gridContents[tabLabel] = getGroup(contents, { ...this.props.groups[groupId], settings: contents[groupId] }, { action: this.openDialog, ...this.widgetProps });\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// grid layout\r\n\t\t\telse if (!this.gridContents[tabLabel]) {\r\n\t\t\t\tthis.gridContents[tabLabel] = <GridContainer contents={getGridContents(contents, this.props.groups, { action: this.openDialog, ...this.widgetProps })} />\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet tabPanel = (\r\n\t\t\t\t<TabPanel key={'tabPanel-' + tab} renderedTab={tab} selectedTab={this.state.selectedTab} fullscreen={fullscreen}>\r\n\t\t\t\t\t{this.gridContents[tabLabel]}\r\n\t\t\t\t</TabPanel>\r\n\t\t\t);\r\n\t\t\t\r\n\t\t\ttabPanels.push(tabPanel);\r\n\t\t\ttab++;\r\n\t\t}\r\n\t\t\r\n\t\treturn tabPanels;\r\n\t}\r\n\t\r\n\tcloseDialog() {\r\n\t\tthis.setState({ 'dialog': false, 'dialogContents': { 'ts': Date.now(), 'device': {} } });\r\n\t}\r\n\t\r\n\topenDialog(device) {\r\n\t\tthis.setState({ 'dialog': true, 'dialogContents': { 'ts': Date.now(), 'device': device } });\r\n\t}\r\n\t\r\n\tselectTab(tab, title) {\r\n\t\tthis.setState({ selectedTab: tab, tabTitle: title });\r\n\t}\r\n\t\r\n\t/*\r\n\ttoggleDrawer(drawer, open) {\r\n\t\tthis.setState({ [drawer]: open });\r\n\t};\r\n\t*/\r\n\t\r\n    render() {\r\n        return (\r\n\r\n<ThemeProvider theme={theme}>\r\n\t<TopBar title={this.props.settings.topBarTitle || (this.tabsEnabled && this.state.tabTitle) || 'jarvis'}>\r\n\t\t{this.tabsEnabled && <TabBar tabs={this.tabs} selectTab={this.selectTab} />}\r\n\t</TopBar>\r\n\t\r\n\t{/*\r\n\t<Drawer anchor=\"right\" open={this.state.notificationDrawer} onClose={this.toggleDrawer('notificationDrawer', false)}>\r\n\t\t\r\n\t</Drawer>\r\n\t*/}\r\n\r\n\t<Popup open={this.state.dialog} contents={this.state.dialogContents} closeDialog={this.closeDialog} />\r\n\t{this.getTabPanels()}\r\n\t\r\n</ThemeProvider>\r\n\r\n\t\t)\r\n\t}\r\n}\r\n","import React from 'react'\r\nimport LogRocket from 'logrocket'\r\nimport uuid from 'uuid/v3'\r\n\r\nimport Grid from '@material-ui/core/Grid'\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport Skeleton from '@material-ui/lab/Skeleton'\r\n\r\nimport GridContainer from './components/GridContainer'\r\nimport StatusSnackbar from './components/StatusSnackbar'\r\n\r\nimport i18n from './i18n'\r\nimport Connection from './Connection'\r\nimport Device from './Device'\r\nimport Jarvis from './Jarvis'\r\n\r\n\r\n/*\r\n * STYLES\r\n */\r\nimport { withStyles } from '@material-ui/core/styles';\r\nconst styles = theme => ({\r\n\tloading: {\r\n\t\tmargin: '10px 0 0 0',\r\n\t\tcolor: '#999'\r\n\t},\r\n\tgridItem: {\r\n\t\tmargin: theme.spacing(1, 1, 0, 0),\r\n\t\t[theme.breakpoints.down('md')]: {\r\n\t\t\tmarginRight: theme.spacing(0.4, 0.4, 0, 0)\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * CONSTANTS\r\n *\r\n */\r\nconst NODE_SETTINGS = 'jarvis.0.settings';\r\nconst NODE_DEVICES = 'jarvis.0.devices';\r\n\r\n\r\nclass App extends React.Component {\r\n\r\n    constructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.state = {\r\n\t\t\tloaded: [],\r\n\t\t\terror: false,\r\n\t\t\terrorMessage: ''\r\n\t\t}\r\n\t};\r\n\r\n\tcomponentDidMount() {\r\n\r\n\t\t// connect and get connection\r\n\t\tconst noErrorFunction = () => this.setState({ error: false, errorMessage: '' });\r\n\t\tconst url = window.location.port === '3000' ? window.location.protocol + '//' + window.location.hostname + ':8082' :\r\n\t\t\twindow.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\r\n\t\tconst listeners = [\r\n\t\t\t{ 'event': 'connect', 'callback': noErrorFunction },\r\n\t\t\t{ 'event': 'reconnect', 'callback': noErrorFunction },\r\n\t\t\t{ 'event': 'disconnect', 'callback': noErrorFunction },\r\n\t\t\t{ 'event': 'error', 'callback': err => this.setState({ error: true, errorMessage: i18n.t('Connection lost! Trying to reconnect') + '..' }) }\r\n\t\t];\r\n\r\n\t\tthis.socket = Connection.connect(url, listeners);\r\n\r\n\t\t// retrieve settings\r\n\t\tthis.settings = {};\r\n\t\tthis.socket.getState(NODE_SETTINGS)\r\n\t\t\t.then(state => {\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.settings = state && JSON.parse(state.val);\r\n\t\t\t\t\tthis.useSettings();\r\n\t\t\t\t\tthis.setState({ loaded: [...this.state.loaded, 'settings'] });\r\n\t\t\t\t\tconst tab = Object.keys(this.settings.layout)[0];\r\n\t\t\t\t\tif (tab === undefined) {\r\n\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\terror: true,\r\n\t\t\t\t\t\t\terrorMessage: i18n.t('Please create the configuration. See documentation.')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcatch(err) {\r\n\t\t\t\t\tconsole.error('GET_SETTINGS: ' + err.message);\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\terror: true,\r\n\t\t\t\t\t\terrorMessage: i18n.t('Error parsing settings!')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t\t.catch(err => {\r\n\t\t\t\tconsole.error('GET_SETTINGS: ' + err.message);\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\terror: true,\r\n\t\t\t\t\terrorMessage: i18n.t(err)\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\r\n\t\t// retrieve devices\r\n\t\tthis.devices = {};\r\n\t\tthis.groups = {};\r\n\r\n\t\tthis.socket.getState(NODE_DEVICES)\r\n\t\t\t.then(state => {\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.devices = JSON.parse(state.val);\r\n\t\t\t\t\tthis.processDevices(this.devices).then(groups => {\r\n\t\t\t\t\t\tthis.groups = groups;\r\n\t\t\t\t\t\tthis.setState({ loaded: [...this.state.loaded, 'groups'] });\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcatch(err) {\r\n\t\t\t\t\tconsole.error('GET_DEVICES: ' + err.message);\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\terror: true,\r\n\t\t\t\t\t\terrorMessage: i18n.t('Error parsing devices!')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(err => {\r\n\t\t\t\tconsole.error('GET_DEVICES: ' + err.message);\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\terror: true,\r\n\t\t\t\t\terrorMessage: i18n.t('Socket failed while getting devices!')\r\n\t\t\t\t});\r\n\t\t\t});\r\n    }\r\n\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tuseSettings() {\r\n\r\n\t\t// LogRocket\r\n\t\tif (this.settings.debug && this.settings.debug.name && this.settings.debug.email && this.settings.debug.email.indexOf('@') > -1) {\r\n\t\t\tLogRocket.init('36n1xl/jarvis');\r\n\r\n\t\t\tlet id = uuid(this.settings.debug.name + '#' + this.settings.debug.email, 'e63359dc-bc1c-476e-81cd-8f580d09a557');\r\n\t\t\tLogRocket.identify(id, {\r\n\t\t\t\tname: this.settings.debug.name,\r\n\t\t\t\temail: this.settings.debug.email\r\n\t\t\t});\r\n\r\n\t\t\tconsole.info('Opt-In for providing debugging details to the developer. Your ID is: ' + id);\r\n\t\t}\r\n\r\n\t\t// language\r\n\t\twindow.language = (this.settings.language || navigator.language || navigator.userLanguage || 'en').substr(0, 2);\r\n\t\ti18n.setLanguage(window.language);\r\n\t\ti18n.loadTranslations(['en', 'de']);\r\n\r\n\t\t// page title\r\n\t\tif (this.settings.pageTitle) {\r\n\t\t\tdocument.title = this.settings.pageTitle;\r\n\t\t}\r\n\r\n\t\t// favicon\r\n\t\tif (this.settings.pageFavicon && this.settings.pageFavicon.substr(0, 5) === 'data:') {\r\n\t\t\tdocument.getElementById('favicon').href = this.settings.pageFavicon;\r\n\t\t}\r\n\r\n\t\t// translations\r\n\t\tif (this.settings.translations) {\r\n\r\n\t\t\tlet translations = this.settings.translations;\r\n\t\t\tfor (let language in translations) {\r\n\t\t\t\ti18n.setTranslation(language, translations[language]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tgroupDevice(groups, device) {\r\n\r\n\t\t// add device to group(s)\r\n\t\tlet options = device.get('options');\r\n\t\toptions.groups.forEach(group => {\r\n\r\n\t\t\tlet groupId = group.toLowerCase().replace(/ /g, '');\r\n\t\t\tif (!groups[groupId]) {\r\n\t\t\t\tgroups[groupId] = { 'id': groupId, 'name': group, 'devices': [device] };\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tgroups[groupId].devices.push(device);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn groups;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tprocessDevice(deviceProperties) {\r\n\r\n\t\tlet promises = [];\r\n\t\tlet device = null;\r\n\t\ttry {\r\n\t\t\tdevice = new Device(deviceProperties, this.socket, window.language);\r\n\r\n\t\t\t// request primary state value\r\n\t\t\tpromises.push(device.requestDeviceState(null, true));\r\n\r\n\t\t\t// request secondary state value\r\n\t\t\tif (device.secondaryStateKey) {\r\n\t\t\t\tpromises.push(device.requestDeviceState(device.secondaryStateKey, true));\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tcatch(err) {\r\n\t\t\tconsole.warn(err.message);\r\n\t\t}\r\n\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tPromise.allSettled(promises).then(results => {\r\n\r\n\t\t\t\tresults.forEach(result => {\r\n\t\t\t\t\tif (result.status === 'rejected') {\r\n\t\t\t\t\t\tconsole.error(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tresolve(device);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t *\r\n\t */\r\n\tprocessDevices(deviceList) {\r\n\r\n\t\t// loop through all devices of in the device list\r\n\t\tlet promises = [];\r\n\t\tlet groups = {};\r\n\r\n\t\tlet devices = 0, groupedDevices = 0;\r\n\t\tfor (let deviceId in deviceList) {\r\n\t\t\tdevices++;\r\n\r\n\t\t\tdeviceList[deviceId].options = deviceList[deviceId].jarvis;\r\n\t\t\tdelete deviceList[deviceId].jarvis;\r\n\r\n\t\t\tlet deviceProperties = { ...deviceList[deviceId], 'id': deviceId };\r\n\t\t\tpromises.push(new Promise((resolve, reject) => {\r\n\r\n\t\t\t\tthis.processDevice(deviceProperties).then(device => {\r\n\r\n\t\t\t\t\tif (device !== null) {\r\n\t\t\t\t\t\tgroupedDevices++;\r\n\t\t\t\t\t\tgroups = this.groupDevice(groups, device);\r\n\t\t\t\t\t\tresolve(deviceId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treject(deviceId);\r\n\t\t\t\t});\r\n\t\t\t}));\r\n\r\n\t\t\t// check states for own device settings\r\n\t\t\tfor (let stateKey in deviceProperties.states) {\r\n\r\n\t\t\t\tlet state = deviceProperties.states[stateKey];\r\n\t\t\t\tif (state && state.jarvis !== undefined) {\r\n\r\n\t\t\t\t\tpromises.push(new Promise((resolve, reject) => {\r\n\r\n\t\t\t\t\t\tthis.processDevice({ ...deviceProperties, 'id': deviceId + '#' + stateKey, 'states': { [stateKey]: state }, 'options': state.jarvis }).then(device => {\r\n\r\n\t\t\t\t\t\t\tif (device !== null) {\r\n\t\t\t\t\t\t\t\tgroupedDevices++;\r\n\t\t\t\t\t\t\t\tgroups = this.groupDevice(groups, device);\r\n\t\t\t\t\t\t\t\tresolve(deviceId);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treject(deviceId);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new Promise(resolve => Promise.allSettled(promises).then(res => {\r\n\r\n\t\t\t// sort groups\r\n\t\t\tfor (let groupId in groups) {\r\n\t\t\t\tgroups[groupId].devices.sort((item1, item2) => {\r\n\t\t\t\t\tif (item1.options.sort > item2.options.sort) return 1;\r\n\t\t\t\t\telse if (item2.options.sort > item1.options.sort) return -1;\r\n\t\t\t\t\telse return 0;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// return\r\n\t\t\tconsole.info('Processed ' + devices + ' devices. Added ' + groupedDevices + ' devices in ' + Object.keys(groups).length + ' groups.', res, groups);\r\n\t\t\tresolve(groups);\r\n\t\t}));\r\n\t};\r\n\r\n\trenderError(error) {\r\n\t\terror = error || this.state.errorMessage;\r\n\t\tconsole.error(error);\r\n\t\treturn (\r\n\r\n<StatusSnackbar\r\n\tkey={'StatusSnackbar'}\r\n\tvariant=\"error\"\r\n\tcloseButton={false}\r\n\tmessage={error.toString()}\r\n\t/>\r\n\r\n\t\t);\r\n\t}\r\n\r\n\trenderLoadingProgress() {\r\n\t\tconst { classes } = this.props;\r\n\t\treturn (\r\n\r\n<Grid\r\n\tkey=\"loadingProcess\"\r\n\tcontainer\r\n\tspacing={0}\r\n\tdirection=\"column\"\r\n\tjustify=\"center\"\r\n\talignItems=\"center\"\r\n\tstyle={{ minHeight: \"100vh\" }}\r\n\t>\r\n\r\n\t<CircularProgress />\r\n\t<Typography className={classes.loading}>{i18n.t('Retrieving settings')}...</Typography>\r\n\r\n</Grid>\r\n\r\n\t\t);\r\n\t};\r\n\r\n\trenderLoadingSkeleton(props) {\r\n\t\tconst { classes } = this.props;\r\n\t\tconst { topBar, tabBar, gridColumns } = props;\r\n\r\n\t\tconst SkeletonLoader = (props) => <Skeleton animation=\"wave\" variant=\"rect\" className={classes.gridItem} height={props.height} />;\r\n\r\n\t\tlet gridContents = {}\r\n\t\tfor (let column = 1; column <= gridColumns; column++) {\r\n\t\t\tgridContents[column] = gridContents[column] || [];\r\n\r\n\t\t\tlet loaders = Math.random() * (5 - 2) + 2;\r\n\t\t\tfor (let loader = 1; loader <= loaders; loader++) {\r\n\t\t\t\tgridContents[column].push(<SkeletonLoader key={column + '#' + loader} height={(Math.random() * (400 - 100) + 100)} />);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn (\r\n\r\n<React.Fragment>\r\n\t{topBar && <Skeleton animation=\"wave\" variant=\"rect\" height={64} />}\r\n\t{tabBar && <Skeleton animation=\"wave\" variant=\"rect\" height={48} />}\r\n\t<GridContainer key=\"loadingSkeleton\" contents={gridContents} />\r\n</React.Fragment>\r\n\r\n\t\t);\r\n\t}\r\n\r\n    render() {\r\n\r\n\t\t// error message\r\n\t\tconst error = this.state.error ? this.renderError() : null;\r\n\r\n\t\t// loading screens\r\n\t\tif (this.state.error && this.state.loaded.length < 2) {\r\n\t\t\treturn error;\r\n\t\t}\r\n\t\telse if (this.state.loaded.indexOf('settings') === -1) {\r\n\t\t\treturn this.renderLoadingProgress();\r\n\t\t}\r\n\t\telse if (this.state.loaded.indexOf('groups') === -1) {\r\n\t\t\tconst tab = Object.keys(this.settings.layout)[0];\r\n\t\t\tif (tab !== undefined) {\r\n\t\t\t\treturn this.renderLoadingSkeleton({ topBar: true, tabBar: tab !== 1, gridColumns: (tab !== 1 ? Object.keys(this.settings.layout[tab]).length : tab.length) });\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// App\r\n\t\treturn [ error, <Jarvis key=\"jarvis\" settings={this.settings} groups={this.groups} /> ];\r\n\t};\r\n}\r\n\r\nexport default withStyles(styles)(App);\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\n\r\nimport './index.css'\r\nimport App from './App'\r\nimport * as serviceWorker from './serviceWorker'\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","/**\r\n *\r\n *\r\n */\r\nfunction HsvToRgb(h, s = 1, v = 1) {\r\n\tif (Array.isArray(h)) {\r\n\t\tv = h[2];\r\n\t\ts = h[1];\r\n\t\th = h[0];\r\n\t}\r\n\telse if (typeof h === 'string' && h.indexOf(',')) {\r\n\t\t[h, s, v] = h.split(',');\r\n\t}\r\n\t\r\n\tif (h > 1) {\r\n\t\th = h/360;\r\n\t}\r\n\t\r\n\tlet r, g, b, i, f, p, q, t;\r\n\t\r\n\ti = Math.floor(h * 6);\r\n\tf = h * 6 - i;\r\n\tp = v * (1 - s);\r\n\tq = v * (1 - f * s);\r\n\tt = v * (1 - (1 - f) * s);\r\n\t\r\n\tswitch (i % 6) {\r\n\t\tcase 0:\r\n\t\t\tr = v;\r\n\t\t\tg = t;\r\n\t\t\tb = p;\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\tcase 1:\r\n\t\t\tr = q;\r\n\t\t\tg = v;\r\n\t\t\tb = p;\r\n\t\t\tbreak;\r\n\t\t\r\n\t\tcase 2:\r\n\t\t\tr = p;\r\n\t\t\tg = v;\r\n\t\t\tb = t;\r\n\t\t\tbreak;\r\n\t\t\r\n\t\tcase 3:\r\n\t\t\tr = p;\r\n\t\t\tg = q;\r\n\t\t\tb = v;\r\n\t\t\tbreak;\r\n\t\t\r\n\t\tcase 4:\r\n\t\t\tr = t;\r\n\t\t\tg = p;\r\n\t\t\tb = v;\r\n\t\t\tbreak;\r\n\t\t\r\n\t\tcase 5:\r\n\t\t\tr = v;\r\n\t\t\tg = p;\r\n\t\t\tb = q;\r\n\t\t\tbreak;\r\n\t\t\r\n\t\tdefault: // for webpack\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\treturn [\r\n\t\tMath.round(r * 255),\r\n\t\tMath.round(g * 255),\r\n\t\tMath.round(b * 255)\r\n\t];\r\n}\r\n\r\n\r\n/**\r\n *\r\n *\r\n */\r\nfunction RgbToHex(r, g, b) {\r\n\tif (Array.isArray(r)) {\r\n\t\tb = r[2];\r\n\t\tg = r[1];\r\n\t\tr = r[0];\r\n\t}\r\n\telse if (typeof r === 'string' && r.indexOf(',')) {\r\n\t\t[r, g, b] = r.split(',');\r\n\t}\r\n\t\r\n\tr = parseInt(r).toString(16);\r\n\tg = parseInt(g).toString(16);\r\n\tb = parseInt(b).toString(16);\r\n\t\r\n\tif (r.length === 1) r = '0' + r;\r\n\tif (g.length === 1) g = '0' + g;\r\n\tif (b.length === 1) b = '0' + b;\r\n\t\r\n\treturn \"#\" + r + g + b;\r\n}\r\n\r\n\r\nexport default {\r\n\tHsvToRgb,\r\n\tRgbToHex\r\n}","import React, { useState, useEffect } from 'react'\r\nimport { HuePicker, SketchPicker as ColorPicker } from 'react-color'\r\n\r\nimport helpers from '../helpers/colorConverter'\r\nimport defaults from './defaults'\r\n\r\n\r\n/*\r\n * ACTIONS\r\n *\r\n */\r\nfunction LightLevelAction(props) {\r\n\tconst { device, stateKey, stateVal } = props;\r\n\t\r\n\tconst onChange = (e) => {\r\n\t\tsetChecked(e.target.checked);\r\n\t\tdevice.setDeviceState(stateKey, e.target.checked ? 100 : 0).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\tconst [checked, setChecked] = useState(stateVal > 0);\r\n\tuseEffect(() => setChecked(stateVal > 0), [stateVal]);\r\n\t\r\n\t// only show percentage if device has a switch itself\r\n\tif (device.parent && device.parent.states.power) {\r\n\t\treturn <defaults.actions.Action {...props} stateVal={checked} onChange={onChange} />;\r\n\t}\r\n\t\r\n\treturn <defaults.actions.PowerAction {...props} stateVal={checked} onChange={onChange} />\r\n}\r\n\r\nfunction LightColorAction(props) {\r\n\tconst { stateKey, stateVal } = props;\r\n\t\r\n\tconst [colorSpace, setColorSpace] = useState(stateVal);\r\n\tuseEffect(() => setColorSpace(stateVal), [stateVal]);\r\n\t\r\n\tlet colors, labels = {};\r\n\tif (stateKey === 'rgb' && colorSpace) {\r\n\t\tcolors = colorSpace.split(',');\r\n\t\tlabels = { Red: colors[0], Green: colors[1], Blue: colors[2] };\r\n\t\t\r\n\t}\r\n\telse if (stateKey === 'hsv' && colorSpace) {\r\n\t\tcolors = colorSpace.split(',');\r\n\t\tlabels = { Hue: colors[0], Saturation: colors[1], Brightness: colors[2] };\r\n\t}\r\n\t\r\n\tconst Label = defaults.components.Label;\r\n\tlet label = [];\r\n\tfor (let key in labels) {\r\n\t\tlabel.push(<Label key={key} label={key + ' ' + labels[key]} br={true} />);\r\n\t}\r\n\t\r\n\treturn label;\r\n}\r\n\r\n\r\n/*\r\n * COMPONENTS\r\n *\r\n */\r\nfunction LightColorTemperatureComponent(props) {\r\n\tconst Level = defaults.components.LevelComponent;\r\n\treturn (\r\n\t\t<Level min={2000} max={6500} step={10} {...props} />\r\n\t);\r\n}\r\n\r\nfunction LightHueComponent(props) {\r\n\tconst { device, stateKey, stateVal, title } = props;\r\n\t\r\n\tconst onChangeComplete = (color, e) => {\r\n\t\tsetHue(Math.round(color.hsl.h));\r\n\t\tdevice.setDeviceState(stateKey, Math.round(color.hsl.h)).catch(err => console.error(err));\r\n\t}\r\n\t\r\n\tconst [hue, setHue] = useState(stateVal);\r\n\tuseEffect(() => setHue(stateVal), [stateVal]);\r\n\t\r\n\tconst Component = defaults.components.Component;\r\n\tconst color = helpers.RgbToHex(helpers.HsvToRgb(hue));\r\n\treturn (\r\n\r\n<Component title={title || stateKey }>\r\n\t<HuePicker\r\n\t\tcolor={color}\r\n\t\twidth={'100%'}\r\n\t\tonChangeComplete={onChangeComplete}\r\n\t\t/>\r\n\t\t\r\n</Component>\r\n\r\n\t);\r\n}\r\n\r\nfunction LightColorComponent(props) {\r\n\tconst { device, stateKey, stateVal, title } = props;\r\n\t\r\n\tconst onChangeComplete = (color, e) => {\r\n\t\tcolor = color[stateKey];\r\n\t\t\r\n\t\t// RGB\r\n\t\tif (stateKey === 'rgb') {\r\n\t\t\tcolor = [color.r, color.g, color.b].join(',');\r\n\t\t}\r\n\t\t// HSV\r\n\t\telse if (stateKey === 'hsv') {\r\n\t\t\tcolor = [color.h, color.s, color.v].join(',');\r\n\t\t}\r\n\t\t\r\n\t\tdevice.setDeviceState(stateKey, color).catch(err => console.error(err));\r\n\t};\r\n\t\r\n\tlet initialColor = stateVal || '#ffffff';\r\n\t\r\n\t// RGB\r\n\tif (stateKey === 'rgb') {\r\n\t\tinitialColor = helpers.RgbToHex(initialColor);\r\n\t}\r\n\t// HSV\r\n\telse if (stateKey === 'hsv') {\r\n\t\tinitialColor = helpers.RgbToHex(helpers.HsvToRgb(initialColor));\r\n\t}\r\n\t\r\n\tconst [colorSpace, setColorSpace] = useState(initialColor);\r\n\tuseEffect(() => {\r\n\t\t// RGB\r\n\t\tif (stateKey === 'rgb') {\r\n\t\t\tsetColorSpace(helpers.RgbToHex(stateVal));\r\n\t\t}\r\n\t\t// HSV\r\n\t\telse if (stateKey === 'hsv') {\r\n\t\t\tsetColorSpace(helpers.RgbToHex(helpers.HsvToRgb(stateVal)));\r\n\t\t}\r\n\t\t// HEX\r\n\t\telse if (stateKey === 'hex') {\r\n\t\t\tsetColorSpace(stateVal);\r\n\t\t}\r\n\t}, [stateKey, stateVal]);\r\n\t\r\n\tconst Component = defaults.components.Component;\r\n\treturn (\r\n\r\n<Component title={title || stateKey }>\r\n\t<ColorPicker\r\n\t\tcolor={colorSpace}\r\n\t\twidth={'100%'}\r\n\t\tonChangeComplete={onChangeComplete}\r\n\t\t/>\r\n\t\t\r\n</Component>\r\n\r\n\t);\r\n}\r\n\r\n\r\nconst color = {\r\n\ticon: {\r\n\t\t'default': 'palette',\r\n\t},\r\n\tunit: ' °'\r\n}\r\n\r\nexport default {\r\n\tconfigurations: {\r\n\t\tpower: {\r\n\t\t\ticon: {\r\n\t\t\t\t'true': 'lightbulb-on',\r\n\t\t\t\t'false': 'lightbulb-off-outline'\r\n\t\t\t},\r\n\t\t},\r\n\t\tlevel: {\r\n\t\t\tvalue: (val) => val > 0 && val <= 1 ? val * 100 : val,\r\n\t\t\tunit: (value) => value !== 'off' ? ' %' : null,\r\n\t\t\ticon: {\r\n\t\t\t\t'default': 'lightbulb-on',\r\n\t\t\t\t'0': 'lightbulb-off-outline'\r\n\t\t\t},\r\n\t\t\tstate: {\r\n\t\t\t\t'0': 'off'\r\n\t\t\t},\r\n\t\t},\r\n\t\tcolorTemperature: {\r\n\t\t\ticon: {\r\n\t\t\t\t'default': 'thermometer',\r\n\t\t\t},\r\n\t\t\tunit: ' °K'\r\n\t\t},\r\n\t\thue: color,\r\n\t\trgb: color,\r\n\t\thsv: color,\r\n\t\thex: color\r\n\t},\r\n\tcomponents: {\r\n\t\tlevel: defaults.components.LevelComponent,\r\n\t\tcolorTemperature: LightColorTemperatureComponent,\r\n\t\trgb: LightColorComponent,\r\n\t\thsv: LightColorComponent,\r\n\t\thex: LightColorComponent,\r\n\t\thue: LightHueComponent\r\n\t},\r\n\tactions: {\r\n\t\tpower: defaults.actions.PowerAction,\r\n\t\tlevel: LightLevelAction,\r\n\t\trgb: LightColorAction,\r\n\t\thsv: LightColorAction,\r\n\t\thex: LightColorAction\r\n\t},\r\n\tstyles: {\r\n\t\t_any: {\r\n\t\t\t//icon: {},\r\n\t\t\tstate: {\r\n\t\t\t\t'0': {\r\n\t\t\t\t\t'color': '#999'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}","import EventEmitter from 'events'\r\nimport io from 'socket.io-client'\r\n\r\n\r\n/**\r\n * Class for Socket.io conncetion handling.\r\n *\r\n * @description This is based on an implementation @GermanBluefox (https://github.com/GermanBluefox), see https://github.com/ioBroker/adapter-react/blob/master/src/Connection.js\r\n *\t\t\t\tOnly required functions are taken from source class. Major change is that all events are emitted, so proper error handling is possible in the App.\r\n *\r\n *\r\n * @param\t{String}\t\turl\r\n * @param\t{Object}\t\toptions\r\n * @return\t{Socket}\r\n * @see https://github.com/ioBroker/ioBroker.socketio/blob/master/lib/socket.js https://github.com/ioBroker/ioBroker.js-controller/blob/master/lib/adapter.js#L635\r\n *\r\n */\r\nexport default class Socket extends EventEmitter {\r\n\t\r\n\tconstructor(url = null, options = {}) {\r\n\t\tsuper();\r\n\t\t\r\n\t\t// socket connection\r\n\t\tthis.socket = io(url, { timeout: 10000, ...options, query: 'ws=true' });\r\n\t\tthis.statesSubscribes = {}; // subscribed states\r\n\t\t\r\n\t\t/*\r\n\t\t * API events\r\n\t\t * @see https://github.com/socketio/socket.io-client/blob/HEAD/docs/API.md#socket\r\n\t\t *\r\n\t\t */\r\n\t\t// connect\r\n\t\tthis.socket.on('connect', () => this.emit('connect'));\r\n\t\t\r\n\t\t// reconnect: Fired upon a successful reconnection.\r\n\t\tthis.socket.on('reconnect', attempts => this.emit('reconnect', attempts));\r\n\t\t\r\n\t\t// reconnect_error: Fired upon a reconnection attempt error.\r\n\t\tthis.socket.on('reconnect_error', error => this.emit('error', { 'type': 'reconnect', 'event': 'reconnect_error', 'message': error.message }));\r\n\t\t\r\n\t\t// reconnect_failed: Fired upon a reconnection attempt error.\r\n\t\tthis.socket.on('reconnect_failed', () => this.emit('error', { 'type': 'reconnect', 'event': 'reconnect_failed', 'message': 'Reconnection failed!' }));\r\n\t\t\r\n\t\t// discconect\r\n\t\tthis.socket.on('disconnect', reason => this.emit('disconnect', reason));\r\n\t\t\r\n\t\t// connect_error\r\n\t\tthis.socket.on('connect_error', error => this.emit('error', { 'type': 'connect', 'event': 'connect_error', 'message': error.message }));\r\n\t\t\r\n\t\t// connect_timeout\r\n\t\tthis.socket.on('connect_timeout', () => this.emit('error', { 'type': 'connect', 'event': 'connect_timeout', 'message': 'Connect ran into timeout!' }));\r\n\t\t\r\n\t\t// error\r\n\t\tthis.socket.on('error', error => this.emit('error', { 'type': 'error', 'event': 'error', 'message': error.message }));\r\n\t\t\r\n\t\t/*\r\n\t\t * ioBroker events\r\n\t\t *\r\n\t\t */\r\n\t\tthis.socket.on('stateChange', (id, state) => setTimeout(() => this.stateChange(id, state), 0));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Subscribes to multiple states by setting a callback.\r\n\t *\r\n\t */\r\n\tsubscribeStates(ids, cb) {\r\n\t\tids = Array.isArray(ids) ? ids : [ids];\r\n\t\tids.forEach(id => this.subscribeState(id, cb));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Subscribes to a state by setting a callback.\r\n\t *\r\n\t */\r\n\tsubscribeState(id, cb) {\r\n\t\t\r\n\t\tif (!this.statesSubscribes[id]) {\r\n\t\t\tlet reg = id\r\n\t\t\t\t.replace(/\\./g, '\\\\.')\r\n\t\t\t\t.replace(/\\*/g, '.*')\r\n\t\t\t\t.replace(/\\(/g, '\\\\(')\r\n\t\t\t\t.replace(/\\)/g, '\\\\)')\r\n\t\t\t\t.replace(/\\+/g, '\\\\+')\r\n\t\t\t\t.replace(/\\[/g, '\\\\[');\r\n\r\n\t\t\tif (reg.indexOf('*') === -1) {\r\n\t\t\t\treg += '$';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.statesSubscribes[id] = { reg: new RegExp(reg), cbs: [cb] };\r\n\t\t\t\r\n\t\t\tif (this.socket.connected) {\r\n\t\t\t\tthis.socket.emit('subscribe', id);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.statesSubscribes[id].cbs.indexOf(cb) === -1 && this.statesSubscribes[id].cbs.push(cb);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires pre-registered callbacks (via subscribeState) upon state change.\r\n\t *\r\n\t */\r\n\tstateChange(id, state) {\r\n\t\t\r\n\t\tid = id ? id.replace(/[\\s'\"]/g, '_') : '';\r\n\t\tfor (const task in this.statesSubscribes) {\r\n\t\t\tif (this.statesSubscribes.hasOwnProperty(task) && this.statesSubscribes[task].reg.test(id)) {\r\n\t\t\t\tthis.statesSubscribes[task].cbs.forEach(cb => cb(id, state));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets an object view.\r\n\t *\r\n\t */\r\n\tgetAdapterInstances(adapter, cb) {\r\n\t\t\r\n\t\tif (typeof adapter === 'function') {\r\n\t\t\tcb = adapter;\r\n\t\t\tadapter = null;\r\n\t\t}\r\n\t\t\r\n\t\treturn this.getObjectView('system', 'instance', { 'startkey': 'system.adapter.' + (adapter ? adapter + '.' : ''), 'endkey': 'system.adapter.' + (adapter ? adapter + '.999' : 'zzz') }, cb);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets an object.\r\n\t *\r\n\t */\r\n\tgetObject(id, cb) {\r\n\t\t\r\n\t\tif (!cb) {\r\n\t\t\treturn new Promise((resolve, reject) => this.getObject(id, (err, obj) => err ? reject(err) : resolve(obj)));\r\n\t\t} else {\r\n\t\t\tthis.socket.emit('getObject', id, cb);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets an object view.\r\n\t *\r\n\t */\r\n\tgetObjectView(design, search, params, cb) {\r\n\t\t\r\n\t\tif (!cb) {\r\n\t\t\treturn new Promise((resolve, reject) => this.getObjectView(design, search, params, err => err ? reject(err) : resolve()));\r\n\t\t} else {\r\n\t\t\tthis.socket.emit('getObjectView', design, search, params, cb);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets a remote ressource.\r\n\t *\r\n\t */\r\n\tgetRemoteResource(url, cb) {\r\n\t\t\r\n\t\tif (!cb) {\r\n\t\t\treturn new Promise((resolve, reject) => this.getRemoteResource(url, (err, state) => err ? reject(err) : resolve(state)));\r\n\t\t} else {\r\n\t\t\tthis.socket.emit('httpGet', url, cb);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets a state.\r\n\t *\r\n\t */\r\n\tgetState(id, cb) {\r\n\t\t\r\n\t\tif (!cb) {\r\n\t\t\treturn new Promise((resolve, reject) => this.getState(id, (err, state) => err ? reject(err) : resolve(state)));\r\n\t\t} else {\r\n\t\t\tthis.socket.emit('getState', id, cb);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets multiple states at once.\r\n\t *\r\n\t */\r\n\tgetStates(pattern, cb) {\r\n\t\t\r\n\t\tif (!cb) {\r\n\t\t\treturn new Promise((resolve, reject) => this.getStates(pattern, (err, state) => err ? reject(err) : resolve(state)));\r\n\t\t} else {\r\n\t\t\tthis.socket.emit('getStates', pattern, cb);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets the state history.\r\n\t *\r\n\t */\r\n\tgetStateHistory(id, options, cb) {\r\n\t\t\r\n\t\tif (typeof options === 'function') {\r\n\t\t\tcb = options;\r\n\t\t\toptions = {};\r\n\t\t}\r\n\t\t\r\n\t\tif (!cb) {\r\n\t\t\treturn new Promise((resolve, reject) => this.getStateHistory(id, options, (err, state) => err ? reject(err) : resolve(state)));\r\n\t\t} else {\r\n\t\t\tthis.socket.emit('getHistory', id, options, cb);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Sets a state.\r\n\t *\r\n\t */\r\n\tsetState(id, val, cb) {\r\n\t\t\r\n\t\tif (!cb) {\r\n\t\t\treturn new Promise((resolve, reject) => this.setState(id, val, err => err ? reject(err) : resolve()));\r\n\t\t} else {\r\n\t\t\tthis.socket.emit('setState', id, val, cb);\r\n\t\t}\r\n\t}\r\n}\r\n","import Socket from './Socket'\r\n\r\n/**\r\n * Connection\r\n +\r\n *\r\n */\r\nexport default class Connection {\r\n\r\n\t/*\r\n\t * URL\r\n\t */\r\n\tstatic url = window.location.hostname;\r\n\t\r\n\t/*\r\n\t * Connection\r\n\t */\r\n\tstatic connection = null;\r\n\t\r\n\t/**\r\n\t * Connects to the Socket.\r\n\t *\r\n\t * @param\t{String}\turl\r\n\t * @param\t{Array}\t\tlisteners\r\n\t * @return\t{Connection}\r\n\t */\r\n\tstatic connect(url = null, listeners = null) {\r\n\t\t\r\n\t\t// set URL\r\n\t\tif (url) {\r\n\t\t\tConnection.setUrl = url;\r\n\t\t}\r\n\t\t\r\n\t\t// connect\r\n\t\tConnection.connection = new Socket(Connection.url);\r\n\t\t\r\n\t\t// set listeners\r\n\t\tif (listeners) {\r\n\t\t\tConnection.setListeners = listeners;\r\n\t\t}\r\n\t\t\r\n\t\t// return connection\r\n\t\treturn Connection.connection;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets the current Connection.\r\n\t *\r\n\t * @param\tvoid\r\n\t * @return\t{Connection}\tCurrent Connection\r\n\t */\r\n\tstatic get getConnection() {\r\n\t\treturn Connection.connection || null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get the current URL.\r\n\t *\r\n\t * @param\tvoid\r\n\t * @return\t{String}\tURL\r\n\t */\r\n\tstatic get getUrl() {\r\n\t\treturn Connection.url;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Sets an event listener.\r\n\t *\r\n\t * @param\t{Object}\t\t\tlistener\r\n\t * @param\t{String}\t\t\tlistener.event\r\n\t * @param\t{Function}\t\t\tlistener.callback\r\n\t * @return\tvoid\r\n\t */\r\n\tstatic set setListener(listener) {\r\n\t\tConnection.connection.on(listener.event, listener.callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Set event listeners.\r\n\t *\r\n\t * @param\t{Array<Object>}\t\tlisteners\r\n\t * @return \t{Boolean}\r\n\t */\r\n\tstatic set setListeners(listeners = []) {\r\n\t\t\r\n\t\tif (!listeners || !Array.isArray(listeners)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tlisteners.forEach(listener => Connection.setListener = listener);\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Set a new URL (has to be set before calling connect()).\r\n\t *\r\n\t * @param\t{String}\tURL\r\n\t * @return\tvoid\r\n\t */\r\n\tstatic set setUrl(url) {\r\n\t\tConnection.url = url;\r\n\t}\r\n}\r\n"],"sourceRoot":""}